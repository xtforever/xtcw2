/* Generated by wbuild
 * (generator version 3.3)
 */
#include <X11/IntrinsicP.h>
#include <X11/StringDefs.h>
#line 132 "IconSVG.widget"
#include <assert.h>
#line 133 "IconSVG.widget"
#include <stdint.h>
#line 134 "IconSVG.widget"
#include <X11/Intrinsic.h>
#line 135 "IconSVG.widget"
#include <X11/Xmu/Converters.h>
#line 136 "IconSVG.widget"
#include <X11/Xft/Xft.h>
#line 137 "IconSVG.widget"
#include <X11/Xregion.h>
#line 138 "IconSVG.widget"
#include "converters.h"
#line 139 "IconSVG.widget"
#include "xutil.h"
#line 140 "IconSVG.widget"
#include "mls.h"
#line 141 "IconSVG.widget"
#include "canvas-draw.h"
#line 142 "IconSVG.widget"
#include "ximage2.h"
#include <xtcw/IconSVGP.h>
static void _resolve_inheritance(
#if NeedFunctionPrototypes
WidgetClass
#endif
);
#line 26 "IconSVG.widget"
static void expose(
#if NeedFunctionPrototypes
Widget,XEvent *,Region 
#endif
);
#line 32 "IconSVG.widget"
static void initialize(
#if NeedFunctionPrototypes
Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 50 "IconSVG.widget"
static void destroy(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 56 "IconSVG.widget"
static void resize(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 62 "IconSVG.widget"
static void realize(
#if NeedFunctionPrototypes
Widget,XtValueMask *,XSetWindowAttributes *
#endif
);
#line 93 "IconSVG.widget"
static Boolean  set_values(
#if NeedFunctionPrototypes
Widget ,Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 99 "IconSVG.widget"
static XtGeometryResult  query_geometry(
#if NeedFunctionPrototypes
Widget,XtWidgetGeometry *,XtWidgetGeometry *
#endif
);

static XtResource resources[] = {
#line 10 "IconSVG.widget"
{XtNforeground,XtCForeground,XtRPixel,sizeof(((IconSVGRec*)NULL)->iconSVG.foreground),XtOffsetOf(IconSVGRec,iconSVG.foreground),XtRImmediate,(XtPointer)XtDefaultForeground },
#line 11 "IconSVG.widget"
{XtNcallback,XtCCallback,XtRCallback,sizeof(((IconSVGRec*)NULL)->iconSVG.callback),XtOffsetOf(IconSVGRec,iconSVG.callback),XtRImmediate,(XtPointer)NULL },
#line 12 "IconSVG.widget"
{XtNfilename,XtCFilename,XtRString,sizeof(((IconSVGRec*)NULL)->iconSVG.filename),XtOffsetOf(IconSVGRec,iconSVG.filename),XtRImmediate,(XtPointer)""},
#line 13 "IconSVG.widget"
{XtNforced_width,XtCForced_width,XtRDistance,sizeof(((IconSVGRec*)NULL)->iconSVG.forced_width),XtOffsetOf(IconSVGRec,iconSVG.forced_width),XtRImmediate,(XtPointer)0 },
#line 14 "IconSVG.widget"
{XtNforced_height,XtCForced_height,XtRDistance,sizeof(((IconSVGRec*)NULL)->iconSVG.forced_height),XtOffsetOf(IconSVGRec,iconSVG.forced_height),XtRImmediate,(XtPointer)0 },
};

IconSVGClassRec iconSVGClassRec = {
{ /* core_class part */
/* superclass   	*/  (WidgetClass) &coreClassRec,
/* class_name   	*/  "IconSVG",
/* widget_size  	*/  sizeof(IconSVGRec),
/* class_initialize 	*/  NULL,
/* class_part_initialize*/  _resolve_inheritance,
/* class_inited 	*/  FALSE,
/* initialize   	*/  initialize,
/* initialize_hook 	*/  NULL,
/* realize      	*/  realize,
/* actions      	*/  NULL,
/* num_actions  	*/  0,
/* resources    	*/  resources,
/* num_resources 	*/  5,
/* xrm_class    	*/  NULLQUARK,
/* compres_motion 	*/  True ,
/* compress_exposure 	*/  XtExposeCompressMultiple ,
/* compress_enterleave 	*/  True ,
/* visible_interest 	*/  False ,
/* destroy      	*/  destroy,
/* resize       	*/  resize,
/* expose       	*/  expose,
/* set_values   	*/  set_values,
/* set_values_hook 	*/  NULL,
/* set_values_almost 	*/  XtInheritSetValuesAlmost,
/* get_values+hook 	*/  NULL,
/* accept_focus 	*/  XtInheritAcceptFocus,
/* version      	*/  XtVersion,
/* callback_private 	*/  NULL,
/* tm_table      	*/  XtInheritTranslations,
/* query_geometry 	*/  query_geometry,
/* display_acceleator 	*/  XtInheritDisplayAccelerator,
/* extension    	*/  NULL 
},
{ /* IconSVG_class part */
 /* dummy */  0
},
};
WidgetClass iconSVGWidgetClass = (WidgetClass) &iconSVGClassRec;
static void _resolve_inheritance(class)
WidgetClass class;
{
  IconSVGWidgetClass c __attribute__((unused)) = (IconSVGWidgetClass) class;
  IconSVGWidgetClass super __attribute__((unused));
  if (class == iconSVGWidgetClass) return;
  super = (IconSVGWidgetClass)class->core_class.superclass;
}
#line 26 "IconSVG.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 26 "IconSVG.widget"
static void expose(Widget self,XEvent * event,Region  region)
#else
#line 26 "IconSVG.widget"
static void expose(self,event,region)Widget self;XEvent * event;Region  region;
#endif
#line 27 "IconSVG.widget"
{
    XTFUNC();
    xim2_put_image(((IconSVGWidget)self)->iconSVG.img,0,0, 0,0, 0,0, ((IconSVGWidget)self)->core.width, ((IconSVGWidget)self)->core.height );
}
#line 32 "IconSVG.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 32 "IconSVG.widget"
static void initialize(Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 32 "IconSVG.widget"
static void initialize(request,self,args,num_args)Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 33 "IconSVG.widget"
{

    XTFUNC();
    TRACE(1, "IconSVG:%s: init size is: %dx%d", XtName(self),
		 ((IconSVGWidget)self)->core.width,((IconSVGWidget)self)->core.height );


    	if( ((IconSVGWidget)self)->core.width <=0 ) ((IconSVGWidget)self)->core.width = 20;
	if( ((IconSVGWidget)self)->core.height <=0 ) ((IconSVGWidget)self)->core.height = 20;

    ((IconSVGWidget)self)->iconSVG.img = & ((IconSVGWidget)self)->iconSVG.img_buf;

    xim2_load_svg( ((IconSVGWidget)self)->iconSVG.img, ((IconSVGWidget)self)->iconSVG.filename );
    ((IconSVGWidget)self)->iconSVG.prefered_width =  ((IconSVGWidget)self)->iconSVG.img->orig_w;
    ((IconSVGWidget)self)->iconSVG.prefered_height=  ((IconSVGWidget)self)->iconSVG.img->orig_h;
}
#line 50 "IconSVG.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 50 "IconSVG.widget"
static void destroy(Widget self)
#else
#line 50 "IconSVG.widget"
static void destroy(self)Widget self;
#endif
#line 51 "IconSVG.widget"
{
        XTFUNC();
	xim2_delete( ((IconSVGWidget)self)->iconSVG.img );
}
#line 56 "IconSVG.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 56 "IconSVG.widget"
static void resize(Widget self)
#else
#line 56 "IconSVG.widget"
static void resize(self)Widget self;
#endif
#line 57 "IconSVG.widget"
{
	TRACE(1, "IconSVG:%s: resize request is: %dx%d", XtName(self),
		 ((IconSVGWidget)self)->core.width,((IconSVGWidget)self)->core.height );
}
#line 62 "IconSVG.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 62 "IconSVG.widget"
static void realize(Widget self,XtValueMask * mask,XSetWindowAttributes * attributes)
#else
#line 62 "IconSVG.widget"
static void realize(self,mask,attributes)Widget self;XtValueMask * mask;XSetWindowAttributes * attributes;
#endif
#line 63 "IconSVG.widget"
{
    XTFUNC();
	XtCreateWindow(self, (unsigned int) InputOutput,
        		  (Visual *) CopyFromParent,
			  *mask, attributes);

     Display *dpy = XtDisplay(self);
     Visual *vis = DefaultVisual(dpy, DefaultScreen(dpy));

     double scale = 1.0;
     int w = ((IconSVGWidget)self)->core.width;
     int h = ((IconSVGWidget)self)->core.height;

     /* apply forced size constrained only if appropriate */ 
     if(((IconSVGWidget)self)->iconSVG.forced_width && ((IconSVGWidget)self)->iconSVG.forced_width < w && ((IconSVGWidget)self)->iconSVG.forced_height <= h ) {
     	 w = ((IconSVGWidget)self)->iconSVG.forced_width;
	 h = ((IconSVGWidget)self)->iconSVG.forced_height;
     }
     
     /* shrink image, if widget is too small */
     if( w < ((IconSVGWidget)self)->iconSVG.prefered_width || h < ((IconSVGWidget)self)->iconSVG.prefered_height ) {
     	 double scale1 = w * 1.0  / ((IconSVGWidget)self)->iconSVG.prefered_width;
	 double scale2 = h * 1.0 / ((IconSVGWidget)self)->iconSVG.prefered_height;
	 scale = Min(scale1,scale2);
     }

     xim2_render( ((IconSVGWidget)self)->iconSVG.img, dpy, vis, XtWindow(self), scale, 0 );
}
#line 93 "IconSVG.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 93 "IconSVG.widget"
static Boolean  set_values(Widget  old,Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 93 "IconSVG.widget"
static Boolean  set_values(old,request,self,args,num_args)Widget  old;Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 94 "IconSVG.widget"
{
	return True; /* yes we want a redraw */	
}
#line 99 "IconSVG.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 99 "IconSVG.widget"
static XtGeometryResult  query_geometry(Widget self,XtWidgetGeometry * request,XtWidgetGeometry * reply)
#else
#line 99 "IconSVG.widget"
static XtGeometryResult  query_geometry(self,request,reply)Widget self;XtWidgetGeometry * request;XtWidgetGeometry * reply;
#endif
#line 100 "IconSVG.widget"
{

    reply->request_mode = CWX | CWY | CWWidth | CWHeight;
    reply->x=0; reply->y=0;

    TRACE(1,"forced size: %d x %d", ((IconSVGWidget)self)->iconSVG.forced_width,  ((IconSVGWidget)self)->iconSVG.forced_height );

    if( ((IconSVGWidget)self)->iconSVG.forced_width ) {
       	 reply->width =  ((IconSVGWidget)self)->iconSVG.forced_width;
    	 reply->height = ((IconSVGWidget)self)->iconSVG.forced_height;
    }
    else {
    	 reply->width =  ((IconSVGWidget)self)->iconSVG.prefered_width;
    	 reply->height = ((IconSVGWidget)self)->iconSVG.prefered_height;
    }
    
    TRACE(1, "IconSVG:%s: parent request is: %dx%d", XtName(self),
             request->width,
             request->width );

    TRACE(1, "IconSVG:%s: our prefered size is %dx%d", XtName(self),
                  ((IconSVGWidget)self)->iconSVG.prefered_width,
                  ((IconSVGWidget)self)->iconSVG.prefered_height );

    return XtGeometryAlmost;
}
