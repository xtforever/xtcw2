/* Generated by wbuild
 * (generator version 3.3)
 */
#include <X11/IntrinsicP.h>
#include <X11/StringDefs.h>
#line 918 "Wlist4.widget"
#include <assert.h>
#line 919 "Wlist4.widget"
#include <math.h>
#line 920 "Wlist4.widget"
#include <X11/Xft/Xft.h>
#line 921 "Wlist4.widget"
#include "xutil.h"
#line 922 "Wlist4.widget"
#include "Wlist-common.h"
#line 923 "Wlist4.widget"
#include "mls.h"
#line 924 "Wlist4.widget"
#include "converters.h"
#include <xtcw/Wlist4P.h>
#line 121 "Wlist4.widget"
static void highlight(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);
#line 129 "Wlist4.widget"
static void reset(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);
#line 138 "Wlist4.widget"
static void motion_start(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);
#line 167 "Wlist4.widget"
static void motion_end(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);
#line 204 "Wlist4.widget"
static void select_line(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);

static XtActionsRec actionsList[] = {
{"highlight", highlight},
{"reset", reset},
{"motion_start", motion_start},
{"motion_end", motion_end},
{"select_line", select_line},
};

static char defaultTranslations[] = "\
<Btn1Motion>: motion_start() \n\
<Btn1Up>: motion_end() \n\
<EnterWindow>: highlight() \n\
<LeaveWindow>: reset() \n\
";
static void _resolve_inheritance(
#if NeedFunctionPrototypes
WidgetClass
#endif
);
#line 212 "Wlist4.widget"
static int  exec_command(
#if NeedFunctionPrototypes
Widget,int ,int 
#endif
);
#line 248 "Wlist4.widget"
static void gotoxy(
#if NeedFunctionPrototypes
Widget,int ,int 
#endif
);
#line 258 "Wlist4.widget"
static void make_visible(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 274 "Wlist4.widget"
static void update_line(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 297 "Wlist4.widget"
static void draw_line(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 306 "Wlist4.widget"
static void initialize(
#if NeedFunctionPrototypes
Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 344 "Wlist4.widget"
static void destroy(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 356 "Wlist4.widget"
static void realize(
#if NeedFunctionPrototypes
Widget,XtValueMask *,XSetWindowAttributes *
#endif
);
#line 367 "Wlist4.widget"
static void expose(
#if NeedFunctionPrototypes
Widget,XEvent *,Region 
#endif
);
#line 376 "Wlist4.widget"
static void class_initialize(
#if NeedFunctionPrototypes
void
#endif
);
#line 383 "Wlist4.widget"
static void resize(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 394 "Wlist4.widget"
static Boolean  set_values(
#if NeedFunctionPrototypes
Widget ,Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 431 "Wlist4.widget"
static void scroll_up_lines(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 445 "Wlist4.widget"
static void scroll_down_lines(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 458 "Wlist4.widget"
static String  get_line_intern(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 471 "Wlist4.widget"
static String  get_line_str(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 486 "Wlist4.widget"
static void update_line_state(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 493 "Wlist4.widget"
static void render_multiline(
#if NeedFunctionPrototypes
Widget,int ,XftDraw *,XftColor *,XftFont *,int ,int ,char *
#endif
);
#line 510 "Wlist4.widget"
static void print_pixmap(
#if NeedFunctionPrototypes
Widget,int ,int 
#endif
);
#line 548 "Wlist4.widget"
static void print(
#if NeedFunctionPrototypes
Widget,int ,int ,char *
#endif
);
#line 555 "Wlist4.widget"
static void init_graphics(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 576 "Wlist4.widget"
static void update_pixmap_complete(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 602 "Wlist4.widget"
static void update_cache(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 677 "Wlist4.widget"
static int  translate_ypos_to_lineno(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 686 "Wlist4.widget"
static void autoscroll_cb(
#if NeedFunctionPrototypes
XtPointer ,XtIntervalId *
#endif
);
#line 701 "Wlist4.widget"
static void  start_autoscroll(
#if NeedFunctionPrototypes
Widget,int ,ulong 
#endif
);
#line 715 "Wlist4.widget"
static void  set_line_state(
#if NeedFunctionPrototypes
Widget,int ,wheel_colors 
#endif
);
#line 729 "Wlist4.widget"
static void  toggle_line_state(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 740 "Wlist4.widget"
static void update_tabs(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 756 "Wlist4.widget"
static int  tabbed_str_width(
#if NeedFunctionPrototypes
Display *,int ,XftFont *,char *
#endif
);
#line 784 "Wlist4.widget"
static int  render_substr(
#if NeedFunctionPrototypes
Widget,XftDraw *,XftColor *,XftFont *,int ,int ,char *
#endif
);
#line 797 "Wlist4.widget"
static void render_mstr(
#if NeedFunctionPrototypes
Widget,int ,XftDraw *,XftColor *,XftFont *,int ,int ,char *
#endif
);
#line 826 "Wlist4.widget"
static void update_widget_state(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 833 "Wlist4.widget"
static void update_titlebar(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 844 "Wlist4.widget"
static int  is_cached(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 851 "Wlist4.widget"
static int  redraw_line(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 862 "Wlist4.widget"
static void update_cursor(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 899 "Wlist4.widget"
static void clear_selection(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 906 "Wlist4.widget"
static void update_list(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 431 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 431 "Wlist4.widget"
static void scroll_up_lines(Widget self,int  n)
#else
#line 431 "Wlist4.widget"
static void scroll_up_lines(self,n)Widget self;int  n;
#endif
#line 432 "Wlist4.widget"
{
  int dst_y = 0;
  int src_y = n * ((Wlist4Widget)self)->wlist4.line_height;
  int h = ((Wlist4Widget)self)->wlist4.buf.height - src_y;
  assert( h > 0 );
  XCopyArea(XtDisplay(self),((Wlist4Widget)self)->wlist4.pixmap, ((Wlist4Widget)self)->wlist4.pixmap, ((Wlist4Widget)self)->wlist4.gc_copy,
            0, src_y,
            ((Wlist4Widget)self)->wlist4.line_width, h,
            0, dst_y );
}
#line 445 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 445 "Wlist4.widget"
static void scroll_down_lines(Widget self,int  n)
#else
#line 445 "Wlist4.widget"
static void scroll_down_lines(self,n)Widget self;int  n;
#endif
#line 446 "Wlist4.widget"
{
  int src_y = 0;
  int dst_y = n * ((Wlist4Widget)self)->wlist4.line_height;
  int h = ((Wlist4Widget)self)->wlist4.buf.height - dst_y;
  assert( h > 0 );
  XCopyArea(((Wlist4Widget)self)->wlist4.dpy,((Wlist4Widget)self)->wlist4.pixmap, ((Wlist4Widget)self)->wlist4.pixmap, ((Wlist4Widget)self)->wlist4.gc_copy,
            0, src_y,
            ((Wlist4Widget)self)->wlist4.line_width, h,
            0, dst_y );
}
#line 458 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 458 "Wlist4.widget"
static String  get_line_intern(Widget self,int  line)
#else
#line 458 "Wlist4.widget"
static String  get_line_intern(self,line)Widget self;int  line;
#endif
#line 459 "Wlist4.widget"
{
      ((Wlist4Widget)self)->wlist4.line_max = m_len(((Wlist4Widget)self)->wlist4.tableStrs);
      m_setlen( ((Wlist4Widget)self)->wlist4.line_state, ((Wlist4Widget)self)->wlist4.line_max );
      if( m_len(((Wlist4Widget)self)->wlist4.tableStrs) <= line ) return "";
      return STR(((Wlist4Widget)self)->wlist4.tableStrs,line);
}
#line 471 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 471 "Wlist4.widget"
static String  get_line_str(Widget self,int  line)
#else
#line 471 "Wlist4.widget"
static String  get_line_str(self,line)Widget self;int  line;
#endif
#line 472 "Wlist4.widget"
{
  if( ((Wlist4Widget)self)->wlist4.tableStrs ) {
      return get_line_intern( self, line );
  }

  wlist_entry_t ent;
  ent.pos = line; ent.max=0; ent.state = ((Wlist4Widget)self)->wlist4.line_state; ent.data="";
  XtCallCallbackList( self, ((Wlist4Widget)self)->wlist4.getEntry, &ent );
  if( ent.max != m_len(((Wlist4Widget)self)->wlist4.line_state) )
    m_setlen( ((Wlist4Widget)self)->wlist4.line_state, ent.max );
  ((Wlist4Widget)self)->wlist4.line_max = m_len(((Wlist4Widget)self)->wlist4.line_state);
  return ent.data;
}
#line 486 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 486 "Wlist4.widget"
static void update_line_state(Widget self)
#else
#line 486 "Wlist4.widget"
static void update_line_state(self)Widget self;
#endif
#line 487 "Wlist4.widget"
{
  get_line_str(self,0);
}
#line 493 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 493 "Wlist4.widget"
static void render_multiline(Widget self,int  tabs,XftDraw * draw,XftColor * col,XftFont * font,int  x,int  y,char * s)
#else
#line 493 "Wlist4.widget"
static void render_multiline(self,tabs,draw,col,font,x,y,s)Widget self;int  tabs;XftDraw * draw;XftColor * col;XftFont * font;int  x;int  y;char * s;
#endif
#line 494 "Wlist4.widget"
{
  int subs=m_split(0,s, '\n', 0 );
  int p;
  char **str;
  m_foreach( subs, p, str ) {
             render_mstr(self,tabs,draw,col,font,x,y + ((Wlist4Widget)self)->wheel.xftFont->ascent,*str);
             y += ((Wlist4Widget)self)->wheel.xftFont->height;
  }
  m_free_strings(subs,0);
}
#line 510 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 510 "Wlist4.widget"
static void print_pixmap(Widget self,int  line,int  ypos)
#else
#line 510 "Wlist4.widget"
static void print_pixmap(self,line,ypos)Widget self;int  line;int  ypos;
#endif
#line 511 "Wlist4.widget"
{
  uint col;
  char *s = NULL;
  int x,y,w,h;

  if( line < 0 || line >= ((Wlist4Widget)self)->wlist4.line_max )
    return;


  s = get_line_str(self,line);
  if( line >= m_len(((Wlist4Widget)self)->wlist4.line_state) ) col=0;
  else
    col = UCHAR( ((Wlist4Widget)self)->wlist4.line_state, line);

  if( col > 2 ) col=0;

  TRACE(2,"line %d color %d\n",line, col);

  x=0;
  y=ypos * ((Wlist4Widget)self)->wlist4.line_height;
  w=((Wlist4Widget)self)->wlist4.buf.width;
  h=((Wlist4Widget)self)->wlist4.line_height;

  int font_height = ((Wlist4Widget)self)->wheel.xftFont->ascent +  ((Wlist4Widget)self)->wheel.xftFont->descent;
  int font_y_off  = (h - font_height-2) / 2 + ((Wlist4Widget)self)->wheel.xftFont->ascent;

  /* zeile zeichnen: Rect( x,y, w,h ) Inhalt: s, Farbe: gc */
  /*  XFillRectangle($dpy, $pixmap, $gc_copy, x,y,w,h ); */
  XFillRectangle(((Wlist4Widget)self)->wlist4.dpy, ((Wlist4Widget)self)->wlist4.pixmap, ((Wlist4Widget)self)->wheel.gc[col], x,y,w,h );

  render_multiline(self, ((Wlist4Widget)self)->wlist4.tab_pos, ((Wlist4Widget)self)->wlist4.draw, ((Wlist4Widget)self)->wheel.xft_col+col, ((Wlist4Widget)self)->wheel.xftFont,
                      x, y + ((Wlist4Widget)self)->wlist4.line_distance/2, s);

  XDrawLine(((Wlist4Widget)self)->wlist4.dpy, ((Wlist4Widget)self)->wlist4.pixmap, ((Wlist4Widget)self)->wheel.gc[1], x,y + h -2, w, y+h-2 );
  TRACE(2, "Update Line: %d\n", line );
}
#line 548 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 548 "Wlist4.widget"
static void print(Widget self,int  x,int  y,char * s)
#else
#line 548 "Wlist4.widget"
static void print(self,x,y,s)Widget self;int  x;int  y;char * s;
#endif
#line 549 "Wlist4.widget"
{
  if( s && *s )
    XftDrawStringUtf8(((Wlist4Widget)self)->wlist4.draw, ((Wlist4Widget)self)->wheel.xft_col+0, ((Wlist4Widget)self)->wheel.xftFont, x,y, (FcChar8*)s,strlen(s) );
}
#line 555 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 555 "Wlist4.widget"
static void init_graphics(Widget self)
#else
#line 555 "Wlist4.widget"
static void init_graphics(self)Widget self;
#endif
#line 556 "Wlist4.widget"
{
  if( ((Wlist4Widget)self)->wlist4.line_width < ((Wlist4Widget)self)->core.width ) ((Wlist4Widget)self)->wlist4.line_width = ((Wlist4Widget)self)->core.width;

  /* berechnen der puffer Größe: 4-Zeilen größer als das fenster */
  int height;
  height = ((int)(((Wlist4Widget)self)->core.height / ((Wlist4Widget)self)->wlist4.line_height) + PREFETCH_BUFFER) * ((Wlist4Widget)self)->wlist4.line_height;
  ((Wlist4Widget)self)->wlist4.buf.height = height;
  ((Wlist4Widget)self)->wlist4.buf.width  = ((Wlist4Widget)self)->wlist4.line_width;
  ((Wlist4Widget)self)->wlist4.buf.x = 0;
  ((Wlist4Widget)self)->wlist4.buf.y = 0;

  if( ((Wlist4Widget)self)->wlist4.pixmap ) XFreePixmap( ((Wlist4Widget)self)->wlist4.dpy, ((Wlist4Widget)self)->wlist4.pixmap );
  ((Wlist4Widget)self)->wlist4.pixmap = XCreatePixmap(((Wlist4Widget)self)->wlist4.dpy, XtWindow(self), ((Wlist4Widget)self)->wlist4.buf.width, ((Wlist4Widget)self)->wlist4.buf.height,
                         DefaultDepth(((Wlist4Widget)self)->wlist4.dpy, DefaultScreen(((Wlist4Widget)self)->wlist4.dpy)));

  if( ((Wlist4Widget)self)->wlist4.draw) XftDrawDestroy( ((Wlist4Widget)self)->wlist4.draw );
  ((Wlist4Widget)self)->wlist4.draw = XftDrawCreate(((Wlist4Widget)self)->wlist4.dpy, ((Wlist4Widget)self)->wlist4.pixmap,
                       DefaultVisual(((Wlist4Widget)self)->wlist4.dpy, DefaultScreen(((Wlist4Widget)self)->wlist4.dpy)), None);
}
#line 576 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 576 "Wlist4.widget"
static void update_pixmap_complete(Widget self)
#else
#line 576 "Wlist4.widget"
static void update_pixmap_complete(self)Widget self;
#endif
#line 577 "Wlist4.widget"
{
	int i = 0;
	int line_no = ((Wlist4Widget)self)->wlist4.buf.y / ((Wlist4Widget)self)->wlist4.line_height;
	int max = ((Wlist4Widget)self)->wlist4.buf.height / ((Wlist4Widget)self)->wlist4.line_height;

	update_line_state(self); // check line_max

	if( line_no + max -1 >= ((Wlist4Widget)self)->wlist4.line_max ) {
	    max = (((Wlist4Widget)self)->wlist4.line_max - line_no);
	    int h = ((Wlist4Widget)self)->wlist4.buf.height - max * ((Wlist4Widget)self)->wlist4.line_height;
	    int w = ((Wlist4Widget)self)->wlist4.buf.width;
	    XFillRectangle( ((Wlist4Widget)self)->wlist4.dpy, ((Wlist4Widget)self)->wlist4.pixmap, ((Wlist4Widget)self)->wheel.gc[0],
	    		    0, max * ((Wlist4Widget)self)->wlist4.line_height, w, h );
	}

	while( i< max ) {
	       print_pixmap( self, line_no+i, i );
	       i++;
	}
}
#line 602 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 602 "Wlist4.widget"
static void update_cache(Widget self)
#else
#line 602 "Wlist4.widget"
static void update_cache(self)Widget self;
#endif
#line 603 "Wlist4.widget"
{
  int ln_pos, ln_no, buf_a, buf_h, cur_buf_a, buf_d, list_h;
  update_line_state(self); // check line_max
  list_h = ((Wlist4Widget)self)->wlist4.line_max * ((Wlist4Widget)self)->wlist4.line_height;
  /* top_y, top_x korrigieren */
  /* falls der x-offset zu groß ist, verkleinern */
  if( ((Wlist4Widget)self)->wlist4.top_x &&  (((Wlist4Widget)self)->wlist4.top_x + ((Wlist4Widget)self)->core.width > ((Wlist4Widget)self)->wlist4.line_width) ) {
    if( ((Wlist4Widget)self)->core.width < ((Wlist4Widget)self)->wlist4.line_width ) ((Wlist4Widget)self)->wlist4.top_x = ((Wlist4Widget)self)->wlist4.line_width - ((Wlist4Widget)self)->core.width;
    else 	     		   ((Wlist4Widget)self)->wlist4.top_x = 0;
  }
  /* falls die liste vollständig angezeigt werden kann, */
  /* oder der rest der liste das fenster nicht füllt */
  if( ((Wlist4Widget)self)->wlist4.top_y + ((Wlist4Widget)self)->wlist4.list_height > list_h ) {
    /* printf( "top_y:%d\n", $top_y ); */
    if( ((Wlist4Widget)self)->wlist4.list_height >= list_h ) ((Wlist4Widget)self)->wlist4.top_y = 0;
    else                    ((Wlist4Widget)self)->wlist4.top_y = list_h - ((Wlist4Widget)self)->wlist4.list_height;

    /* printf( "top_y:%d\n", $top_y ); */
  }

  /* anzuzeigender bereich liegt im puffer */
  if( ((Wlist4Widget)self)->wlist4.top_y + ((Wlist4Widget)self)->core.height <= ((Wlist4Widget)self)->wlist4.buf.y + ((Wlist4Widget)self)->wlist4.buf.height &&
      ((Wlist4Widget)self)->wlist4.top_y >= ((Wlist4Widget)self)->wlist4.buf.y ) return;

  buf_h = ((Wlist4Widget)self)->wlist4.buf.height / ((Wlist4Widget)self)->wlist4.line_height;	/* anzahl zeilen im Puffer */
  cur_buf_a = ((Wlist4Widget)self)->wlist4.buf.y / ((Wlist4Widget)self)->wlist4.line_height;	/* erste zeile */
  buf_a = ((Wlist4Widget)self)->wlist4.top_y / ((Wlist4Widget)self)->wlist4.line_height;        /* neue erste zeile */
  buf_d = buf_a - cur_buf_a;		/* abstand in zeilen */

  if( buf_d == 0 ) goto update_all;

  if( buf_d > 0 ) {	/* neue erste zeile > puffer erste zeile */
    if( buf_d >= buf_h ) goto update_all;
    scroll_up_lines(self, buf_d );
    ln_pos = buf_h - buf_d;
    ln_no = cur_buf_a + buf_h;  /* letzte zeile +1*/
  }
  else {                  /* neue erste zeile < puffer erste zeile */
    buf_d = -buf_d;
    if( buf_d >= buf_h ) goto update_all;

	    if( buf_d < PREFETCH_BUFFER ) {
	    	if( buf_a > PREFETCH_BUFFER - buf_d ) {
		    buf_a -= PREFETCH_BUFFER - buf_d;
		    buf_d = PREFETCH_BUFFER;
		} else {
		    buf_d += buf_a;
		    buf_a = 0;
		}
	    }

	    scroll_down_lines(self, buf_d );
	    ln_pos = 0; ln_no = buf_a;
            /*
	    printf( "cur_buf_a=%d, buf_h = %d, buf_a=%d\n", cur_buf_a, buf_h, buf_a );
	    printf( "buf_d = %d, ln_no=%d, ln_pos = %d\n", buf_d, ln_no, ln_pos );
            */

	}

	while( buf_d-- ) {
      	    print_pixmap(self, ln_no + buf_d, ln_pos + buf_d );
    	}

	((Wlist4Widget)self)->wlist4.buf.y = buf_a * ((Wlist4Widget)self)->wlist4.line_height; /* neue startposition setzen */
	return;
	/*-----------------------------------------------------------------*/

	update_all:
	((Wlist4Widget)self)->wlist4.buf.y = buf_a * ((Wlist4Widget)self)->wlist4.line_height;
	update_pixmap_complete(self);
	/*-----------------------------------------------------------------*/
}
#line 677 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 677 "Wlist4.widget"
static int  translate_ypos_to_lineno(Widget self,int  y)
#else
#line 677 "Wlist4.widget"
static int  translate_ypos_to_lineno(self,y)Widget self;int  y;
#endif
#line 678 "Wlist4.widget"
{
  int line_no;
  y -= ((Wlist4Widget)self)->wlist4.titleBarHeight;
  line_no = (((Wlist4Widget)self)->wlist4.top_y + y) / ((Wlist4Widget)self)->wlist4.line_height;
  return line_no;
}
#line 686 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 686 "Wlist4.widget"
static void autoscroll_cb(XtPointer  client_data,XtIntervalId * id)
#else
#line 686 "Wlist4.widget"
static void autoscroll_cb(client_data,id)XtPointer  client_data;XtIntervalId * id;
#endif
#line 687 "Wlist4.widget"
{
	Widget self = (Widget) client_data;

	int new_y = ((Wlist4Widget)self)->wlist4.top_y + ((Wlist4Widget)self)->wlist4.pixel_to_scroll;

	if( new_y > 0 && new_y + ((Wlist4Widget)self)->core.height < ((Wlist4Widget)self)->wlist4.line_max * ((Wlist4Widget)self)->wlist4.line_height && ((Wlist4Widget)self)->wlist4.autoscroll_cnt > 0 )
	{
		((Wlist4Widget)self)->wlist4.autoscroll_id =
	  	   XtAppAddTimeOut( XtWidgetToApplicationContext( self ), 100, autoscroll_cb, self );
		((Wlist4Widget)self)->wlist4.autoscroll_cnt--;
		gotoxy( self, -1, new_y );
	}
}
#line 701 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 701 "Wlist4.widget"
static void  start_autoscroll(Widget self,int  y,ulong  t)
#else
#line 701 "Wlist4.widget"
static void  start_autoscroll(self,y,t)Widget self;int  y;ulong  t;
#endif
#line 702 "Wlist4.widget"
{
	((Wlist4Widget)self)->wlist4.autoscroll_cnt  =  25;
	float speed = fabs( (((Wlist4Widget)self)->wlist4.drag_start_y - y) * 1.0 / t );
	float pixel_total = (((Wlist4Widget)self)->wlist4.drag_start_y - y) / speed;
	float pixel_per_update = 1+ pixel_total / ((Wlist4Widget)self)->wlist4.autoscroll_cnt;
	printf( "drag_y0:%d, y1:%d\n", ((Wlist4Widget)self)->wlist4.drag_start_y, y );
	printf( "autoscroll started: speed:%f, pixel_total:%f\n", speed, pixel_total );

	((Wlist4Widget)self)->wlist4.pixel_to_scroll =  pixel_per_update;

	((Wlist4Widget)self)->wlist4.autoscroll_id = XtAppAddTimeOut( XtWidgetToApplicationContext( self ), 40, autoscroll_cb, self );
}
#line 715 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 715 "Wlist4.widget"
static void  set_line_state(Widget self,int  lineno,wheel_colors  col)
#else
#line 715 "Wlist4.widget"
static void  set_line_state(self,lineno,col)Widget self;int  lineno;wheel_colors  col;
#endif
#line 716 "Wlist4.widget"
{
	if( lineno < 0 || lineno >= m_len(((Wlist4Widget)self)->wlist4.line_state) ) return;

	CHAR(((Wlist4Widget)self)->wlist4.line_state, lineno) = col;
	/* check screen update */
	int first_line = ((Wlist4Widget)self)->wlist4.buf.y / ((Wlist4Widget)self)->wlist4.line_height;
	int last_line = first_line + ((Wlist4Widget)self)->wlist4.buf.height / ((Wlist4Widget)self)->wlist4.line_height;
	if( lineno >= first_line && lineno < last_line ) {
	    print_pixmap( self, lineno, lineno - first_line );
	    update_list(self);
	}
}
#line 729 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 729 "Wlist4.widget"
static void  toggle_line_state(Widget self,int  lineno)
#else
#line 729 "Wlist4.widget"
static void  toggle_line_state(self,lineno)Widget self;int  lineno;
#endif
#line 730 "Wlist4.widget"
{
  if( lineno < 0 || lineno >= m_len(((Wlist4Widget)self)->wlist4.line_state) ) return;
  wheel_colors col = CHAR( ((Wlist4Widget)self)->wlist4.line_state, lineno );
  col = !col;
  set_line_state( self, lineno, col );
}
#line 740 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 740 "Wlist4.widget"
static void update_tabs(Widget self)
#else
#line 740 "Wlist4.widget"
static void update_tabs(self)Widget self;
#endif
#line 741 "Wlist4.widget"
{
  if( ! ((Wlist4Widget)self)->wlist4.tabs ) return;
  int mult = ((Wlist4Widget)self)->wlist4.unit;
  if( mult == 0 ) mult = xft_textwidth( ((Wlist4Widget)self)->wlist4.dpy, ((Wlist4Widget)self)->wheel.xftFont, "w" );
  if( ((Wlist4Widget)self)->wlist4.tab_pos )
    m_clear(((Wlist4Widget)self)->wlist4.tab_pos);
  else ((Wlist4Widget)self)->wlist4.tab_pos = m_create(10,sizeof(int));

  int p,*d, v;
  m_foreach( ((Wlist4Widget)self)->wlist4.tabs, p, d ) {
    v = (*d) * mult;
    m_put( ((Wlist4Widget)self)->wlist4.tab_pos, &v );
  }
}
#line 756 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 756 "Wlist4.widget"
static int  tabbed_str_width(Display * dpy,int  tabs,XftFont * font,char * buf)
#else
#line 756 "Wlist4.widget"
static int  tabbed_str_width(dpy,tabs,font,buf)Display * dpy;int  tabs;XftFont * font;char * buf;
#endif
#line 757 "Wlist4.widget"
{
  char **str;
  int p,
      cur_x = 0,
      cur_tab = 0;
  int subs=m_split(0,buf, '\t', 1 );
  int last_substr = m_len(subs) > 0 ? m_len(subs)-1 : 0;

  m_foreach( subs, p, str ) {
    cur_x +=  xft_textwidth( dpy, font, *str );

    if( p != last_substr && tabs ) {
        while( cur_tab < m_len(tabs) ) {
           if( INT(tabs,cur_tab) > cur_x )
           {
              cur_x = INT(tabs,cur_tab);
              break;
           }
           cur_tab++; /* skip this tab */
        }
    }
  }
  m_free_strings(subs,0);
  return cur_x;
}
#line 784 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 784 "Wlist4.widget"
static int  render_substr(Widget self,XftDraw * draw,XftColor * col,XftFont * font,int  x,int  y,char * s)
#else
#line 784 "Wlist4.widget"
static int  render_substr(self,draw,col,font,x,y,s)Widget self;XftDraw * draw;XftColor * col;XftFont * font;int  x;int  y;char * s;
#endif
#line 785 "Wlist4.widget"
{
  int xoff;
  if(is_empty(s) ) return 0;

  xoff = xft_textwidth( ((Wlist4Widget)self)->wlist4.dpy, font, s );
  XftDrawStringUtf8(draw, col, font,
                    x,y, (FcChar8*)s,strlen(s) );
  return xoff;
}
#line 797 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 797 "Wlist4.widget"
static void render_mstr(Widget self,int  tabs,XftDraw * draw,XftColor * col,XftFont * font,int  pix_x,int  pix_y,char * buf)
#else
#line 797 "Wlist4.widget"
static void render_mstr(self,tabs,draw,col,font,pix_x,pix_y,buf)Widget self;int  tabs;XftDraw * draw;XftColor * col;XftFont * font;int  pix_x;int  pix_y;char * buf;
#endif
#line 798 "Wlist4.widget"
{
  if( is_empty(buf) ) return;

  int cur_tab = 0; /* index des nächsten tab */
  int xoff;        /* größe des teil-str. in pixel */
  int cur_x = 0;   /* x-pos. des nächsten str. in pixel */
  int subs=m_split(0,buf, '\t', 0 );
  int p;
  char **str;
  m_foreach( subs, p, str ) {
    if( cur_x >= ((Wlist4Widget)self)->wlist4.buf.width ) break;
    xoff = render_substr(self, draw,col,font, pix_x + cur_x, pix_y, *str);
    cur_x += xoff;
    if( tabs ) {
        while( cur_tab < m_len(tabs) ) {
           if( INT(tabs,cur_tab) > cur_x )
           {
              cur_x = INT(tabs,cur_tab);
              break;
           }
           cur_tab++; /* skip this tab */
        }
    }
  }

  m_free_strings(subs,0);
}
#line 826 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 826 "Wlist4.widget"
static void update_widget_state(Widget self)
#else
#line 826 "Wlist4.widget"
static void update_widget_state(self)Widget self;
#endif
#line 827 "Wlist4.widget"
{
  if( ((Wlist4Widget)self)->wheel.state >= STATE_MAX ) ((Wlist4Widget)self)->wheel.state=0;
  XSetWindowBorder( ((Wlist4Widget)self)->wlist4.dpy, XtWindow(self),
                        ((Wlist4Widget)self)->wheel.pixel[((Wlist4Widget)self)->wheel.state + COLOR_FG_MAX] );
}
#line 833 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 833 "Wlist4.widget"
static void update_titlebar(Widget self)
#else
#line 833 "Wlist4.widget"
static void update_titlebar(self)Widget self;
#endif
#line 834 "Wlist4.widget"
{

  uint y = ((Wlist4Widget)self)->wlist4.titleBarHeight;
  XFillRectangle( ((Wlist4Widget)self)->wlist4.dpy,XtWindow(self),((Wlist4Widget)self)->wlist4.titleBarGC, 0,0,((Wlist4Widget)self)->core.width,y);
  XDrawLine( ((Wlist4Widget)self)->wlist4.dpy,XtWindow(self),((Wlist4Widget)self)->wheel.gc[1],0,y-2,((Wlist4Widget)self)->core.width, y-2 );
  render_mstr( self, ((Wlist4Widget)self)->wlist4.tab_pos, ((Wlist4Widget)self)->wlist4.draw_title, ((Wlist4Widget)self)->wheel.xft_col, ((Wlist4Widget)self)->wheel.xftFont,
               0, ((Wlist4Widget)self)->wheel.xftFont->ascent, m_buf(((Wlist4Widget)self)->wlist4.titleBar) );
}
#line 844 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 844 "Wlist4.widget"
static int  is_cached(Widget self,int  lineno)
#else
#line 844 "Wlist4.widget"
static int  is_cached(self,lineno)Widget self;int  lineno;
#endif
#line 845 "Wlist4.widget"
{
  int first_line = ((Wlist4Widget)self)->wlist4.buf.y / ((Wlist4Widget)self)->wlist4.line_height;
  int last_line = first_line + ((Wlist4Widget)self)->wlist4.buf.height / ((Wlist4Widget)self)->wlist4.line_height;
  return( lineno >= first_line && lineno < last_line );
}
#line 851 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 851 "Wlist4.widget"
static int  redraw_line(Widget self,int  lineno)
#else
#line 851 "Wlist4.widget"
static int  redraw_line(self,lineno)Widget self;int  lineno;
#endif
#line 852 "Wlist4.widget"
{
  int first_line = ((Wlist4Widget)self)->wlist4.buf.y / ((Wlist4Widget)self)->wlist4.line_height;
  int last_line = first_line + ((Wlist4Widget)self)->wlist4.buf.height / ((Wlist4Widget)self)->wlist4.line_height;
  if( lineno >= first_line && lineno < last_line ) {
    print_pixmap( self, lineno, lineno - first_line );
    return 1;
  }
  return 0;
}
#line 862 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 862 "Wlist4.widget"
static void update_cursor(Widget self)
#else
#line 862 "Wlist4.widget"
static void update_cursor(self)Widget self;
#endif
#line 863 "Wlist4.widget"
{
  int dirty = 0;
  if( ((Wlist4Widget)self)->wlist4.key_cursor == ((Wlist4Widget)self)->wlist4.key_cursor_drawn ) return;

  if( ((Wlist4Widget)self)->wlist4.key_cursor_drawn >= 0 ) {
    CHAR( ((Wlist4Widget)self)->wlist4.line_state, ((Wlist4Widget)self)->wlist4.key_cursor_drawn ) = ((Wlist4Widget)self)->wlist4.key_cursor_state;
    dirty += redraw_line(self,((Wlist4Widget)self)->wlist4.key_cursor_drawn);
    ((Wlist4Widget)self)->wlist4.key_cursor_drawn=-1;
  }

  if( ((Wlist4Widget)self)->wlist4.key_cursor >= 0 ) {

    if( ((Wlist4Widget)self)->wlist4.key_cursor >= m_len(((Wlist4Widget)self)->wlist4.line_state) )
      ((Wlist4Widget)self)->wlist4.key_cursor = m_len(((Wlist4Widget)self)->wlist4.line_state)-1;

    ((Wlist4Widget)self)->wlist4.key_cursor_state = CHAR( ((Wlist4Widget)self)->wlist4.line_state, ((Wlist4Widget)self)->wlist4.key_cursor );
    CHAR(((Wlist4Widget)self)->wlist4.line_state, ((Wlist4Widget)self)->wlist4.key_cursor) = STATE_ARMED;
    ((Wlist4Widget)self)->wlist4.key_cursor_drawn = ((Wlist4Widget)self)->wlist4.key_cursor;
    redraw_line(self,((Wlist4Widget)self)->wlist4.key_cursor);
    dirty = 1;
    int last_visible_line = (((Wlist4Widget)self)->wlist4.top_y + ((Wlist4Widget)self)->wlist4.list_height) / ((Wlist4Widget)self)->wlist4.line_height;
    printf( "crsr:%d Vis:%d\n", ((Wlist4Widget)self)->wlist4.key_cursor, last_visible_line );

    if( ((Wlist4Widget)self)->wlist4.key_cursor >= last_visible_line ) {
      int y=(((Wlist4Widget)self)->wlist4.key_cursor+1) * ((Wlist4Widget)self)->wlist4.line_height - ((Wlist4Widget)self)->wlist4.list_height;
      ((Wlist4WidgetClass)self->core.widget_class)->wlist4_class.gotoxy(self,-1,y); dirty=0;
    }
    else if( ((Wlist4Widget)self)->wlist4.key_cursor < (((Wlist4Widget)self)->wlist4.top_y / ((Wlist4Widget)self)->wlist4.line_height) )
      {
        ((Wlist4WidgetClass)self->core.widget_class)->wlist4_class.gotoxy(self,-1,((Wlist4Widget)self)->wlist4.key_cursor*((Wlist4Widget)self)->wlist4.line_height); dirty=0;
      }
  }

  if( dirty ) update_list(self);
}
#line 899 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 899 "Wlist4.widget"
static void clear_selection(Widget self)
#else
#line 899 "Wlist4.widget"
static void clear_selection(self)Widget self;
#endif
#line 900 "Wlist4.widget"
{
        int len = m_len(((Wlist4Widget)self)->wlist4.line_state);
        while( len-- ) CHAR(((Wlist4Widget)self)->wlist4.line_state,len)=0;
}
#line 906 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 906 "Wlist4.widget"
static void update_list(Widget self)
#else
#line 906 "Wlist4.widget"
static void update_list(self)Widget self;
#endif
#line 907 "Wlist4.widget"
{
  uint bx = 1;
  uint by = ((Wlist4Widget)self)->wlist4.titleBarHeight;
  update_cache(self);
  XCopyArea(((Wlist4Widget)self)->wlist4.dpy,((Wlist4Widget)self)->wlist4.pixmap,XtWindow(self), ((Wlist4Widget)self)->wlist4.gc_copy,
            ((Wlist4Widget)self)->wlist4.top_x, ((Wlist4Widget)self)->wlist4.top_y - ((Wlist4Widget)self)->wlist4.buf.y, ((Wlist4Widget)self)->core.width -2*bx, ((Wlist4Widget)self)->core.height-by,
	    bx, by );
}

static XtResource resources[] = {
#line 53 "Wlist4.widget"
{XtNtableStrs,XtCTableStrs,XtRInt,sizeof(((Wlist4Rec*)NULL)->wlist4.tableStrs),XtOffsetOf(Wlist4Rec,wlist4.tableStrs),XtRImmediate,(XtPointer)0 },
#line 54 "Wlist4.widget"
{XtNfg,XtCFg,XtRXftColor,sizeof(((Wlist4Rec*)NULL)->wlist4.fg),XtOffsetOf(Wlist4Rec,wlist4.fg),XtRString,(XtPointer)"White"},
#line 55 "Wlist4.widget"
{XtNnotify,XtCNotify,XtRCallback,sizeof(((Wlist4Rec*)NULL)->wlist4.notify),XtOffsetOf(Wlist4Rec,wlist4.notify),XtRImmediate,(XtPointer)NULL },
#line 56 "Wlist4.widget"
{XtNgetEntry,XtCGetEntry,XtRCallback,sizeof(((Wlist4Rec*)NULL)->wlist4.getEntry),XtOffsetOf(Wlist4Rec,wlist4.getEntry),XtRImmediate,(XtPointer)NULL },
#line 57 "Wlist4.widget"
{XtNline_distance,XtCLine_distance,XtRInt,sizeof(((Wlist4Rec*)NULL)->wlist4.line_distance),XtOffsetOf(Wlist4Rec,wlist4.line_distance),XtRImmediate,(XtPointer)2 },
#line 58 "Wlist4.widget"
{XtNtop_x,XtCTop_x,XtRInt,sizeof(((Wlist4Rec*)NULL)->wlist4.top_x),XtOffsetOf(Wlist4Rec,wlist4.top_x),XtRImmediate,(XtPointer)0 },
#line 59 "Wlist4.widget"
{XtNtop_y,XtCTop_y,XtRInt,sizeof(((Wlist4Rec*)NULL)->wlist4.top_y),XtOffsetOf(Wlist4Rec,wlist4.top_y),XtRImmediate,(XtPointer)0 },
#line 62 "Wlist4.widget"
{XtNmultiline,XtCMultiline,XtRInt,sizeof(((Wlist4Rec*)NULL)->wlist4.multiline),XtOffsetOf(Wlist4Rec,wlist4.multiline),XtRImmediate,(XtPointer)1 },
#line 66 "Wlist4.widget"
{XtNline_max,XtCLine_max,XtRInt,sizeof(((Wlist4Rec*)NULL)->wlist4.line_max),XtOffsetOf(Wlist4Rec,wlist4.line_max),XtRImmediate,(XtPointer)0 },
#line 70 "Wlist4.widget"
{XtNline_height,XtCLine_height,XtRInt,sizeof(((Wlist4Rec*)NULL)->wlist4.line_height),XtOffsetOf(Wlist4Rec,wlist4.line_height),XtRImmediate,(XtPointer)0 },
#line 74 "Wlist4.widget"
{XtNlist_height,XtCList_height,XtRInt,sizeof(((Wlist4Rec*)NULL)->wlist4.list_height),XtOffsetOf(Wlist4Rec,wlist4.list_height),XtRImmediate,(XtPointer)0 },
#line 76 "Wlist4.widget"
{XtNline_width,XtCLine_width,XtRInt,sizeof(((Wlist4Rec*)NULL)->wlist4.line_width),XtOffsetOf(Wlist4Rec,wlist4.line_width),XtRImmediate,(XtPointer)0 },
#line 78 "Wlist4.widget"
{XtNtabs,XtCTabs,XtRArrayInt,sizeof(((Wlist4Rec*)NULL)->wlist4.tabs),XtOffsetOf(Wlist4Rec,wlist4.tabs),XtRImmediate,(XtPointer)0 },
#line 81 "Wlist4.widget"
{XtNunit,XtCUnit,XtRDistance,sizeof(((Wlist4Rec*)NULL)->wlist4.unit),XtOffsetOf(Wlist4Rec,wlist4.unit),XtRImmediate,(XtPointer)0 },
#line 83 "Wlist4.widget"
{XtNline_bh,XtCLine_bh,XtRInt,sizeof(((Wlist4Rec*)NULL)->wlist4.line_bh),XtOffsetOf(Wlist4Rec,wlist4.line_bh),XtRImmediate,(XtPointer)0 },
#line 84 "Wlist4.widget"
{XtNtitleBar,XtCTitleBar,XtRArrayChar,sizeof(((Wlist4Rec*)NULL)->wlist4.titleBar),XtOffsetOf(Wlist4Rec,wlist4.titleBar),XtRImmediate,(XtPointer)0 },
#line 85 "Wlist4.widget"
{XtNtitleBarCol,XtCTitleBarCol,XtRPixel,sizeof(((Wlist4Rec*)NULL)->wlist4.titleBarCol),XtOffsetOf(Wlist4Rec,wlist4.titleBarCol),XtRString,(XtPointer)"#101010"},
};

Wlist4ClassRec wlist4ClassRec = {
{ /* core_class part */
/* superclass   	*/  (WidgetClass) &wheelClassRec,
/* class_name   	*/  "Wlist4",
/* widget_size  	*/  sizeof(Wlist4Rec),
/* class_initialize 	*/  class_initialize,
/* class_part_initialize*/  _resolve_inheritance,
/* class_inited 	*/  FALSE,
/* initialize   	*/  initialize,
/* initialize_hook 	*/  NULL,
/* realize      	*/  realize,
/* actions      	*/  actionsList,
/* num_actions  	*/  5,
/* resources    	*/  resources,
/* num_resources 	*/  17,
/* xrm_class    	*/  NULLQUARK,
/* compres_motion 	*/  False ,
/* compress_exposure 	*/  FALSE ,
/* compress_enterleave 	*/  False ,
/* visible_interest 	*/  False ,
/* destroy      	*/  destroy,
/* resize       	*/  resize,
/* expose       	*/  expose,
/* set_values   	*/  set_values,
/* set_values_hook 	*/  NULL,
/* set_values_almost 	*/  XtInheritSetValuesAlmost,
/* get_values+hook 	*/  NULL,
/* accept_focus 	*/  XtInheritAcceptFocus,
/* version      	*/  XtVersion,
/* callback_private 	*/  NULL,
/* tm_table      	*/  defaultTranslations,
/* query_geometry 	*/  XtInheritQueryGeometry,
/* display_acceleator 	*/  XtInheritDisplayAccelerator,
/* extension    	*/  NULL 
},
{ /* Wheel_class part */
exec_command,
XtInherit_sig_recv,
},
{ /* Wlist4_class part */
gotoxy,
make_visible,
update_line,
draw_line,
},
};
WidgetClass wlist4WidgetClass = (WidgetClass) &wlist4ClassRec;
/*ARGSUSED*/
#line 121 "Wlist4.widget"
static void highlight(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
  if( ((Wlist4Widget)self)->wheel.state == STATE_NORMAL ) {
    ((Wlist4Widget)self)->wheel.state = STATE_SELECTED;
    update_widget_state(self);
  }
}

/*ARGSUSED*/
#line 129 "Wlist4.widget"
static void reset(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
  if( ((Wlist4Widget)self)->wheel.state != STATE_NORMAL ) {
    ((Wlist4Widget)self)->wheel.state = STATE_NORMAL;
    update_widget_state(self);
  }
}

/*ARGSUSED*/
#line 138 "Wlist4.widget"
static void motion_start(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
	int y = event->xbutton.y;
	int lineno;
	ulong t = (ulong ) event->xbutton.time;
	lineno = translate_ypos_to_lineno(self,y );
	if( ((Wlist4Widget)self)->wlist4.drag_time == 0 ) goto restart_drag;

	/* drag startete vor über einer sekunde, seitdem keine änderung */
	/* darum: vergessen und neu starten */
	if( ((Wlist4Widget)self)->wlist4.drag_update + 1000 < t ) goto restart_drag;
	((Wlist4Widget)self)->wlist4.drag_update = t;

	if( y != ((Wlist4Widget)self)->wlist4.drag_last_y ) {
	    int top = ((Wlist4Widget)self)->wlist4.top_y + (((Wlist4Widget)self)->wlist4.drag_last_y - y);
	    ((Wlist4Widget)self)->wlist4.drag_last_y = y;
	    gotoxy( self, -1, top );
	}
	return; /* drag in progress */

  restart_drag:
	((Wlist4Widget)self)->wlist4.drag_start_y = event->xbutton.y;
	((Wlist4Widget)self)->wlist4.drag_last_y = event->xbutton.y;
	((Wlist4Widget)self)->wlist4.drag_time = t;
	((Wlist4Widget)self)->wlist4.drag_update = t;
	((Wlist4Widget)self)->wlist4.drag_line_start = lineno;
	/* printf( "start %d\n",  lineno ); */
}

/*ARGSUSED*/
#line 167 "Wlist4.widget"
static void motion_end(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
      int y = event->xbutton.y;
      ulong t = (ulong ) event->xbutton.time;
      int lineno = translate_ypos_to_lineno(self,event->xbutton.y );

      if( ((Wlist4Widget)self)->wlist4.drag_time == 0 || t < ((Wlist4Widget)self)->wlist4.drag_time ) goto click;

      t -= ((Wlist4Widget)self)->wlist4.drag_time;
      /* printf( "line: start: %d, end: %d, time: %ld\n", $drag_line_start, lineno, t ); */

      y -= ((Wlist4Widget)self)->wlist4.drag_start_y;
      if( y > -15 && y < 15 ) goto click;

      /*      if( t < AUTO_SCROLL_TIME_MS ) { start_autoscroll($, event->xbutton.y, t ); }
      */

      goto reset_drag;

      /* kein drag nur ein click */
      click:
      XtCallCallbackList(self, ((Wlist4Widget)self)->wlist4.notify, lineno );
      // toggle_line_state( self, lineno );
      goto reset_drag;

      reset_drag:
      ((Wlist4Widget)self)->wlist4.drag_time = 0;
}

/*ARGSUSED*/
#line 204 "Wlist4.widget"
static void select_line(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
	XtCallCallbackList(self,((Wlist4Widget)self)->wlist4.notify,event);
}

static void _resolve_inheritance(class)
WidgetClass class;
{
  Wlist4WidgetClass c __attribute__((unused)) = (Wlist4WidgetClass) class;
  Wlist4WidgetClass super __attribute__((unused));
  if (class == wlist4WidgetClass) return;
  super = (Wlist4WidgetClass)class->core_class.superclass;
  if (c->wlist4_class.gotoxy == XtInherit_gotoxy)
    c->wlist4_class.gotoxy = super->wlist4_class.gotoxy;
  if (c->wlist4_class.make_visible == XtInherit_make_visible)
    c->wlist4_class.make_visible = super->wlist4_class.make_visible;
  if (c->wlist4_class.update_line == XtInherit_update_line)
    c->wlist4_class.update_line = super->wlist4_class.update_line;
  if (c->wlist4_class.draw_line == XtInherit_draw_line)
    c->wlist4_class.draw_line = super->wlist4_class.draw_line;
}
#line 212 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 212 "Wlist4.widget"
static int  exec_command(Widget self,int  cmd,int  val)
#else
#line 212 "Wlist4.widget"
static int  exec_command(self,cmd,val)Widget self;int  cmd;int  val;
#endif
#line 213 "Wlist4.widget"
{
  switch( cmd ) {
  case WHEEL_FIRE:
    if( ((Wlist4Widget)self)->wheel.state == STATE_ARMED ) {
      ((Wlist4Widget)self)->wheel.state = STATE_SELECTED;
      ((Wlist4Widget)self)->wlist4.key_cursor = -1;
    }
    else {
      ((Wlist4Widget)self)->wheel.state = STATE_ARMED;
      ((Wlist4Widget)self)->wlist4.key_cursor = ((Wlist4Widget)self)->wlist4.top_y / ((Wlist4Widget)self)->wlist4.line_height;
    }
    update_widget_state(self);
    update_cursor(self);
    return 1;

  case WHEEL_LEFT:
    if( ((Wlist4Widget)self)->wheel.state != STATE_ARMED ) return 0;
    if( ((Wlist4Widget)self)->wlist4.key_cursor > 0 )
      ((Wlist4Widget)self)->wlist4.key_cursor--;
    update_cursor(self);
    return 1;

  case WHEEL_RIGHT:
    if( ((Wlist4Widget)self)->wheel.state != STATE_ARMED ) return 0;
    ((Wlist4Widget)self)->wlist4.key_cursor++;
    update_cursor(self);
    return 1;
  }

  return 0; /* not used */
}
#line 248 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 248 "Wlist4.widget"
static void gotoxy(Widget self,int  x,int  y)
#else
#line 248 "Wlist4.widget"
static void gotoxy(self,x,y)Widget self;int  x;int  y;
#endif
#line 249 "Wlist4.widget"
{
	if( x >= 0 ) ((Wlist4Widget)self)->wlist4.top_x = x;
	if( y >= 0 ) ((Wlist4Widget)self)->wlist4.top_y = y;
	update_list(self);
}
#line 258 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 258 "Wlist4.widget"
static void make_visible(Widget self,int  line_number)
#else
#line 258 "Wlist4.widget"
static void make_visible(self,line_number)Widget self;int  line_number;
#endif
#line 259 "Wlist4.widget"
{
  /* falls line_number im Cache -- redraw */

  /* setze buf.y so dass line_number am ende des cache liegt */
  /* setze top_y so dass letzte cache zeile angezeigt werden kann */
}
#line 274 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 274 "Wlist4.widget"
static void update_line(Widget self,int  line_number)
#else
#line 274 "Wlist4.widget"
static void update_line(self,line_number)Widget self;int  line_number;
#endif
#line 275 "Wlist4.widget"
{
  int y;

  if( ! ((Wlist4Widget)self)->wlist4.draw ) return;
  update_line_state(self);
  y = line_number * ((Wlist4Widget)self)->wlist4.line_height;
  /* inside cache ? */
  if( y >= ((Wlist4Widget)self)->wlist4.buf.y && y < ((Wlist4Widget)self)->wlist4.buf.height + ((Wlist4Widget)self)->wlist4.buf.y ) {
    ((Wlist4WidgetClass)self->core.widget_class)->wlist4_class.draw_line(self, line_number);
    /* visible ? */
    if( y >= ((Wlist4Widget)self)->wlist4.top_y && y < ((Wlist4Widget)self)->wlist4.top_y + ((Wlist4Widget)self)->core.height ) {
      ((Wlist4WidgetClass)self->core.widget_class)->core_class.expose( self, NULL, NULL );
      return;
    }
    /* not visible, but inside cache, move top_y */
  }

  /* outside cache! move top_y */
  ((Wlist4Widget)self)->wlist4.top_y = y - ((Wlist4Widget)self)->core.height + ((Wlist4Widget)self)->wlist4.line_height;
  ((Wlist4WidgetClass)self->core.widget_class)->core_class.expose( self, NULL, NULL );
}
#line 297 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 297 "Wlist4.widget"
static void draw_line(Widget self,int  line_number)
#else
#line 297 "Wlist4.widget"
static void draw_line(self,line_number)Widget self;int  line_number;
#endif
#line 298 "Wlist4.widget"
{
  int y = line_number * ((Wlist4Widget)self)->wlist4.line_height;
  /* outside  cache ? */
  if( y < ((Wlist4Widget)self)->wlist4.buf.y || y >= ((Wlist4Widget)self)->wlist4.buf.height + ((Wlist4Widget)self)->wlist4.buf.y ) return;
  y = line_number - (((Wlist4Widget)self)->wlist4.buf.y / ((Wlist4Widget)self)->wlist4.line_height); /* pos. im cache */
  print_pixmap( self, line_number, y );
}
#line 306 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 306 "Wlist4.widget"
static void initialize(Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 306 "Wlist4.widget"
static void initialize(request,self,args,num_args)Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 307 "Wlist4.widget"
{
        /* TODO: dpy initialisierung in andere wlist widgets uebertragen */
        ((Wlist4Widget)self)->wlist4.dpy = XtDisplay(self);

  if( ((Wlist4Widget)self)->wlist4.multiline == 0 ) ((Wlist4Widget)self)->wlist4.multiline = 1;
  ((Wlist4Widget)self)->wlist4.gc_copy =  XtGetGC(self, 0,0 );
  ((Wlist4Widget)self)->wlist4.draw = NULL;
  /* trennlinie ist 2 pixel hoch */
  ((Wlist4Widget)self)->wlist4.line_height = ((Wlist4Widget)self)->wheel.xftFont->height * ((Wlist4Widget)self)->wlist4.multiline + ((Wlist4Widget)self)->wlist4.line_distance + 2;
  ((Wlist4Widget)self)->wlist4.line_state = m_create(100,1);

  update_tabs(self);
  if( ((Wlist4Widget)self)->wlist4.titleBar ) {
      ((Wlist4Widget)self)->wlist4.titleBarHeight = ((Wlist4Widget)self)->wheel.xftFont->height+3;
      ((Wlist4Widget)self)->wlist4.titleBarWidth = tabbed_str_width(((Wlist4Widget)self)->wlist4.dpy, ((Wlist4Widget)self)->wlist4.tab_pos, ((Wlist4Widget)self)->wheel.xftFont, m_buf(((Wlist4Widget)self)->wlist4.titleBar));
   }
   else {
     ((Wlist4Widget)self)->wlist4.titleBarHeight = 1;
     ((Wlist4Widget)self)->wlist4.titleBarWidth  = 20;
   }

  if( ((Wlist4Widget)self)->core.width == 0 ) ((Wlist4Widget)self)->core.width = ((Wlist4Widget)self)->wlist4.titleBarWidth;
  ((Wlist4Widget)self)->wlist4.line_width = ((Wlist4Widget)self)->core.width;


  ((Wlist4Widget)self)->wlist4.key_cursor_drawn = -1;
  ((Wlist4Widget)self)->wlist4.key_cursor = -1;

  XtGCMask mask;
  XGCValues values;
  mask = GCForeground;
  values.foreground = ((Wlist4Widget)self)->wlist4.titleBarCol;
  ((Wlist4Widget)self)->wlist4.titleBarGC = XtGetGC(self,mask,&values);

  if( ((Wlist4Widget)self)->core.height == 0 ) ((Wlist4Widget)self)->core.height = 20;
}
#line 344 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 344 "Wlist4.widget"
static void destroy(Widget self)
#else
#line 344 "Wlist4.widget"
static void destroy(self)Widget self;
#endif
#line 345 "Wlist4.widget"
{
  XtReleaseGC(self,((Wlist4Widget)self)->wlist4.titleBarGC);
  XtReleaseGC(self,((Wlist4Widget)self)->wlist4.gc_copy);
  if( ((Wlist4Widget)self)->wlist4.draw) XftDrawDestroy( ((Wlist4Widget)self)->wlist4.draw );
  if( ((Wlist4Widget)self)->wlist4.pixmap ) XFreePixmap( ((Wlist4Widget)self)->wlist4.dpy, ((Wlist4Widget)self)->wlist4.pixmap );
  if( ((Wlist4Widget)self)->wlist4.titleBar ) { m_free( ((Wlist4Widget)self)->wlist4.titleBar ); ((Wlist4Widget)self)->wlist4.titleBar=0; }
  m_free( ((Wlist4Widget)self)->wlist4.tab_pos );
  m_free( ((Wlist4Widget)self)->wlist4.tabs);
  m_free( ((Wlist4Widget)self)->wlist4.line_state );
}
#line 356 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 356 "Wlist4.widget"
static void realize(Widget self,XtValueMask * mask,XSetWindowAttributes * attributes)
#else
#line 356 "Wlist4.widget"
static void realize(self,mask,attributes)Widget self;XtValueMask * mask;XSetWindowAttributes * attributes;
#endif
#line 357 "Wlist4.widget"
{
     XtCreateWindow(self, (unsigned int) InputOutput,
                    (Visual *) CopyFromParent, *mask, attributes);
     ((Wlist4Widget)self)->wlist4.draw_title = XftDrawCreate( ((Wlist4Widget)self)->wlist4.dpy, XtWindow(self),
                                  DefaultVisual(((Wlist4Widget)self)->wlist4.dpy, DefaultScreen(((Wlist4Widget)self)->wlist4.dpy)), None);

     init_graphics(self);
     update_pixmap_complete(self);
 }
#line 367 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 367 "Wlist4.widget"
static void expose(Widget self,XEvent * event,Region  region)
#else
#line 367 "Wlist4.widget"
static void expose(self,event,region)Widget self;XEvent * event;Region  region;
#endif
#line 368 "Wlist4.widget"
{
	if( !XtIsRealized(self)) return;
        if( ((Wlist4Widget)self)->wlist4.titleBar ) update_titlebar(self);
        ((Wlist4Widget)self)->wlist4.list_height = ((Wlist4Widget)self)->core.height - ((Wlist4Widget)self)->wlist4.titleBarHeight;
        update_list(self);
}
#line 376 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 376 "Wlist4.widget"
static void class_initialize(void)
#else
#line 376 "Wlist4.widget"
static void class_initialize()
#endif
#line 377 "Wlist4.widget"
{
	  converters_init();
}
#line 383 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 383 "Wlist4.widget"
static void resize(Widget self)
#else
#line 383 "Wlist4.widget"
static void resize(self)Widget self;
#endif
#line 384 "Wlist4.widget"
{
	/* der buffer sollte immer 3 zeilen größer als das window sein */
	if( XtIsRealized(self) )
	  if( ((Wlist4Widget)self)->core.height + 3 * ((Wlist4Widget)self)->wlist4.line_height > ((Wlist4Widget)self)->wlist4.buf.height || ((Wlist4Widget)self)->core.width > ((Wlist4Widget)self)->wlist4.buf.width )
	  {
	 	init_graphics(self);
		update_pixmap_complete(self);
	  }
}
#line 394 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 394 "Wlist4.widget"
static Boolean  set_values(Widget  old,Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 394 "Wlist4.widget"
static Boolean  set_values(old,request,self,args,num_args)Widget  old;Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 395 "Wlist4.widget"
{
	int n = *num_args;

	/* wenn farben, font, zeilen-daten geändert worden sind,
           muss der cache aktualisiert werden
         */

         if( XtIsRealized(self) )
	 while( n-- )
	 {
                 if(strncmp( args[n].name, "tableS",6 ) == 0 )
                 {
                   clear_selection(self);
                   update_pixmap_complete(self);
                   break;
                 }


                 if( ( strncmp( args[n].name, "bg_",3 ) == 0 )
		     || ( strncmp( args[n].name, "fg", 2 ) == 0 )
		     || ( strncmp( args[n].name, "xftFont", 7 ) == 0 ) )
                  {
			update_pixmap_complete(self);
			break;
		  }
	 }


	return True; /* im zweifelsfall ist ein expose() immer richtig */
}
#line 11 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 11 "Wlist4.widget"
void  wlist4_gotoxy(Widget  w,int  x,int  y)
#else
#line 11 "Wlist4.widget"
void  wlist4_gotoxy(w,x,y)Widget  w;int  x;int  y;
#endif
#line 12 "Wlist4.widget"
{
  Wlist4WidgetClass wc = (Wlist4WidgetClass)XtClass(w);
  if( XtIsSubclass( w, wlist4WidgetClass) && wc->wlist4_class.gotoxy )
    {
      wc->wlist4_class.gotoxy(w,x,y);
    }
}
#line 20 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 20 "Wlist4.widget"
void  wlist4_update_line(Widget  w,int  line)
#else
#line 20 "Wlist4.widget"
void  wlist4_update_line(w,line)Widget  w;int  line;
#endif
#line 21 "Wlist4.widget"
{
  Wlist4WidgetClass wc = (Wlist4WidgetClass)XtClass(w);
  if( XtIsSubclass( w, wlist4WidgetClass) && wc->wlist4_class.update_line )
    {
      wc->wlist4_class.update_line(w,line);
    }
}
#line 29 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 29 "Wlist4.widget"
void  wlist4_set_line_state(Widget  w,int  lineno,wheel_colors  col)
#else
#line 29 "Wlist4.widget"
void  wlist4_set_line_state(w,lineno,col)Widget  w;int  lineno;wheel_colors  col;
#endif
#line 30 "Wlist4.widget"
{
  Wlist4WidgetClass wc = (Wlist4WidgetClass)XtClass(w);
  if( XtIsSubclass(w, wlist4WidgetClass) )
      set_line_state(  w, lineno, col );
}
#line 36 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 36 "Wlist4.widget"
void  wlist4_clear_selection(Widget  w)
#else
#line 36 "Wlist4.widget"
void  wlist4_clear_selection(w)Widget  w;
#endif
#line 37 "Wlist4.widget"
{
  Wlist4WidgetClass wc = (Wlist4WidgetClass)XtClass(w);
  if( XtIsSubclass(w, wlist4WidgetClass) )
      clear_selection(  w );
}
#line 44 "Wlist4.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 44 "Wlist4.widget"
void  wlist4_update_all(Widget self)
#else
#line 44 "Wlist4.widget"
void  wlist4_update_all(self)Widget self;
#endif
#line 45 "Wlist4.widget"
{
	init_graphics(self);
	update_pixmap_complete(self);
	((Wlist4WidgetClass)self->core.widget_class)->core_class.expose(self,0,0);
}
