/* Generated by wbuild
 * (generator version 3.3)
 */
#include <X11/IntrinsicP.h>
#include <X11/StringDefs.h>
#line 982 "Wlist.widget"
#include <assert.h>
#line 983 "Wlist.widget"
#include <math.h>
#line 984 "Wlist.widget"
#include <X11/Xft/Xft.h>
#line 985 "Wlist.widget"
#include "xutil.h"
#line 986 "Wlist.widget"
#include "Wlist-common.h"
#line 987 "Wlist.widget"
#include "mls.h"
#line 988 "Wlist.widget"
#include "converters.h"
#include <xtcw/WlistP.h>
#line 131 "Wlist.widget"
static void highlight(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);
#line 139 "Wlist.widget"
static void reset(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);
#line 148 "Wlist.widget"
static void motion_start(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);
#line 177 "Wlist.widget"
static void motion_end(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);
#line 206 "Wlist.widget"
static void toggle_line_state_act(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);
#line 218 "Wlist.widget"
static void select_line(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);

static XtActionsRec actionsList[] = {
{"highlight", highlight},
{"reset", reset},
{"motion_start", motion_start},
{"motion_end", motion_end},
{"toggle_line_state_act", toggle_line_state_act},
{"select_line", select_line},
};

static char defaultTranslations[] = "\
<Btn1Motion>: motion_start() \n\
<Btn1Up>: motion_end() \n\
<EnterWindow>: highlight() \n\
<LeaveWindow>: reset() \n\
";
static void _resolve_inheritance(
#if NeedFunctionPrototypes
WidgetClass
#endif
);
#line 226 "Wlist.widget"
static XtGeometryResult  query_geometry(
#if NeedFunctionPrototypes
Widget,XtWidgetGeometry *,XtWidgetGeometry *
#endif
);
#line 248 "Wlist.widget"
static int  exec_command(
#if NeedFunctionPrototypes
Widget,int ,int 
#endif
);
#line 284 "Wlist.widget"
static void gotoxy(
#if NeedFunctionPrototypes
Widget,int ,int 
#endif
);
#line 295 "Wlist.widget"
static void make_visible(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 311 "Wlist.widget"
static void update_line(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 334 "Wlist.widget"
static void draw_line(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 343 "Wlist.widget"
static void initialize(
#if NeedFunctionPrototypes
Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 381 "Wlist.widget"
static void destroy(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 393 "Wlist.widget"
static void realize(
#if NeedFunctionPrototypes
Widget,XtValueMask *,XSetWindowAttributes *
#endif
);
#line 404 "Wlist.widget"
static void expose(
#if NeedFunctionPrototypes
Widget,XEvent *,Region 
#endif
);
#line 414 "Wlist.widget"
static void class_initialize(
#if NeedFunctionPrototypes
void
#endif
);
#line 421 "Wlist.widget"
static void resize(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 432 "Wlist.widget"
static Boolean  set_values(
#if NeedFunctionPrototypes
Widget ,Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 470 "Wlist.widget"
static void calc_geometry(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 488 "Wlist.widget"
static void scroll_up_lines(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 502 "Wlist.widget"
static void scroll_down_lines(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 515 "Wlist.widget"
static String  get_line_intern(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 528 "Wlist.widget"
static String  get_line_str(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 543 "Wlist.widget"
static void update_line_state(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 550 "Wlist.widget"
static void render_multiline(
#if NeedFunctionPrototypes
Widget,int ,XftDraw *,XftColor *,XftFont *,int ,int ,char *
#endif
);
#line 567 "Wlist.widget"
static void print_pixmap(
#if NeedFunctionPrototypes
Widget,int ,int 
#endif
);
#line 605 "Wlist.widget"
static void print(
#if NeedFunctionPrototypes
Widget,int ,int ,char *
#endif
);
#line 612 "Wlist.widget"
static void init_graphics(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 636 "Wlist.widget"
static void update_pixmap_complete(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 662 "Wlist.widget"
static void update_cache(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 739 "Wlist.widget"
static int  translate_ypos_to_lineno(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 748 "Wlist.widget"
static void autoscroll_cb(
#if NeedFunctionPrototypes
XtPointer ,XtIntervalId *
#endif
);
#line 763 "Wlist.widget"
static void  start_autoscroll(
#if NeedFunctionPrototypes
Widget,int ,ulong 
#endif
);
#line 777 "Wlist.widget"
static void  set_line_state(
#if NeedFunctionPrototypes
Widget,int ,wheel_colors 
#endif
);
#line 791 "Wlist.widget"
static void  toggle_line_state(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 802 "Wlist.widget"
static void update_tabs(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 818 "Wlist.widget"
static int  tabbed_str_width(
#if NeedFunctionPrototypes
Display *,int ,XftFont *,char *
#endif
);
#line 846 "Wlist.widget"
static int  render_substr(
#if NeedFunctionPrototypes
Widget,XftDraw *,XftColor *,XftFont *,int ,int ,char *
#endif
);
#line 859 "Wlist.widget"
static void render_mstr(
#if NeedFunctionPrototypes
Widget,int ,XftDraw *,XftColor *,XftFont *,int ,int ,char *
#endif
);
#line 888 "Wlist.widget"
static void update_widget_state(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 895 "Wlist.widget"
static void update_titlebar(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 906 "Wlist.widget"
static int  is_cached(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 913 "Wlist.widget"
static int  redraw_line(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 924 "Wlist.widget"
static void update_cursor(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 961 "Wlist.widget"
static void clear_selection(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 968 "Wlist.widget"
static void update_list(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 470 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 470 "Wlist.widget"
static void calc_geometry(Widget self)
#else
#line 470 "Wlist.widget"
static void calc_geometry(self)Widget self;
#endif
#line 471 "Wlist.widget"
{
	if( ((WlistWidget)self)->wlist.visible_lines > 0 )
	{
		((WlistWidget)self)->wlist.prefered_height = ((WlistWidget)self)->wlist.visible_lines * ((WlistWidget)self)->wlist.line_height;	
        }

	if( ((WlistWidget)self)->wlist.titleBarWidth > 0 )
	{
		((WlistWidget)self)->wlist.prefered_width = ((WlistWidget)self)->wlist.titleBarWidth;
	}

	if( ((WlistWidget)self)->wlist.prefered_height < 10 ) ((WlistWidget)self)->wlist.prefered_height = 200;
	if( ((WlistWidget)self)->wlist.prefered_width  < 10 ) ((WlistWidget)self)->wlist.prefered_width  = 50;
}
#line 488 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 488 "Wlist.widget"
static void scroll_up_lines(Widget self,int  n)
#else
#line 488 "Wlist.widget"
static void scroll_up_lines(self,n)Widget self;int  n;
#endif
#line 489 "Wlist.widget"
{
  int dst_y = 0;
  int src_y = n * ((WlistWidget)self)->wlist.line_height;
  int h = ((WlistWidget)self)->wlist.buf.height - src_y;
  assert( h > 0 );
  XCopyArea(XtDisplay(self),((WlistWidget)self)->wlist.pixmap, ((WlistWidget)self)->wlist.pixmap, ((WlistWidget)self)->wlist.gc_copy,
            0, src_y,
            ((WlistWidget)self)->wlist.line_width, h,
            0, dst_y );
}
#line 502 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 502 "Wlist.widget"
static void scroll_down_lines(Widget self,int  n)
#else
#line 502 "Wlist.widget"
static void scroll_down_lines(self,n)Widget self;int  n;
#endif
#line 503 "Wlist.widget"
{
  int src_y = 0;
  int dst_y = n * ((WlistWidget)self)->wlist.line_height;
  int h = ((WlistWidget)self)->wlist.buf.height - dst_y;
  assert( h > 0 );
  XCopyArea(((WlistWidget)self)->wlist.dpy,((WlistWidget)self)->wlist.pixmap, ((WlistWidget)self)->wlist.pixmap, ((WlistWidget)self)->wlist.gc_copy,
            0, src_y,
            ((WlistWidget)self)->wlist.line_width, h,
            0, dst_y );
}
#line 515 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 515 "Wlist.widget"
static String  get_line_intern(Widget self,int  line)
#else
#line 515 "Wlist.widget"
static String  get_line_intern(self,line)Widget self;int  line;
#endif
#line 516 "Wlist.widget"
{
      ((WlistWidget)self)->wlist.line_max = m_len(((WlistWidget)self)->wlist.tableStrs);
      m_setlen( ((WlistWidget)self)->wlist.line_state, ((WlistWidget)self)->wlist.line_max );
      if( m_len(((WlistWidget)self)->wlist.tableStrs) <= line ) return "";
      return STR(((WlistWidget)self)->wlist.tableStrs,line);
}
#line 528 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 528 "Wlist.widget"
static String  get_line_str(Widget self,int  line)
#else
#line 528 "Wlist.widget"
static String  get_line_str(self,line)Widget self;int  line;
#endif
#line 529 "Wlist.widget"
{
  if( ((WlistWidget)self)->wlist.tableStrs ) {
      return get_line_intern( self, line );
  }

  wlist_entry_t ent;
  ent.pos = line; ent.max=0; ent.state = ((WlistWidget)self)->wlist.line_state; ent.data="";
  XtCallCallbackList( self, ((WlistWidget)self)->wlist.getEntry, &ent );
  if( ent.max != m_len(((WlistWidget)self)->wlist.line_state) )
    m_setlen( ((WlistWidget)self)->wlist.line_state, ent.max );
  ((WlistWidget)self)->wlist.line_max = m_len(((WlistWidget)self)->wlist.line_state);
  return ent.data;
}
#line 543 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 543 "Wlist.widget"
static void update_line_state(Widget self)
#else
#line 543 "Wlist.widget"
static void update_line_state(self)Widget self;
#endif
#line 544 "Wlist.widget"
{
  get_line_str(self,0);
}
#line 550 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 550 "Wlist.widget"
static void render_multiline(Widget self,int  tabs,XftDraw * draw,XftColor * col,XftFont * font,int  x,int  y,char * s)
#else
#line 550 "Wlist.widget"
static void render_multiline(self,tabs,draw,col,font,x,y,s)Widget self;int  tabs;XftDraw * draw;XftColor * col;XftFont * font;int  x;int  y;char * s;
#endif
#line 551 "Wlist.widget"
{
  int subs=m_split(0,s, '\n', 0 );
  int p;
  char **str;
  m_foreach( subs, p, str ) {
             render_mstr(self,tabs,draw,col,font,x,y + ((WlistWidget)self)->wheel.xftFont->ascent,*str);
             y += ((WlistWidget)self)->wheel.xftFont->height;
  }
  m_free_strings(subs,0);
}
#line 567 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 567 "Wlist.widget"
static void print_pixmap(Widget self,int  line,int  ypos)
#else
#line 567 "Wlist.widget"
static void print_pixmap(self,line,ypos)Widget self;int  line;int  ypos;
#endif
#line 568 "Wlist.widget"
{
  uint col;
  char *s = NULL;
  int x,y,w,h;

  if( line < 0 || line >= ((WlistWidget)self)->wlist.line_max )
    return;


  s = get_line_str(self,line);
  if( line >= m_len(((WlistWidget)self)->wlist.line_state) ) col=0;
  else
    col = UCHAR( ((WlistWidget)self)->wlist.line_state, line);

  if( col > 2 ) col=0;

  TRACE(2,"line %d color %d\n",line, col);

  x=0;
  y=ypos * ((WlistWidget)self)->wlist.line_height;
  w=((WlistWidget)self)->wlist.buf.width;
  h=((WlistWidget)self)->wlist.line_height;

  int font_height = ((WlistWidget)self)->wheel.xftFont->ascent +  ((WlistWidget)self)->wheel.xftFont->descent;
  int font_y_off  = (h - font_height-2) / 2 + ((WlistWidget)self)->wheel.xftFont->ascent;

  /* zeile zeichnen: Rect( x,y, w,h ) Inhalt: s, Farbe: gc */
  /*  XFillRectangle($dpy, $pixmap, $gc_copy, x,y,w,h ); */
  XFillRectangle(((WlistWidget)self)->wlist.dpy, ((WlistWidget)self)->wlist.pixmap, ((WlistWidget)self)->wheel.gc[col], x,y,w,h );

  render_multiline(self, ((WlistWidget)self)->wlist.tab_pos, ((WlistWidget)self)->wlist.draw, ((WlistWidget)self)->wheel.xft_col+col, ((WlistWidget)self)->wheel.xftFont,
                      x, y + ((WlistWidget)self)->wlist.line_distance/2, s);

  XDrawLine(((WlistWidget)self)->wlist.dpy, ((WlistWidget)self)->wlist.pixmap, ((WlistWidget)self)->wheel.gc[1], x,y + h -2, w, y+h-2 );
  TRACE(2, "Update Line: %d\n", line );
}
#line 605 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 605 "Wlist.widget"
static void print(Widget self,int  x,int  y,char * s)
#else
#line 605 "Wlist.widget"
static void print(self,x,y,s)Widget self;int  x;int  y;char * s;
#endif
#line 606 "Wlist.widget"
{
  if( s && *s )
    XftDrawStringUtf8(((WlistWidget)self)->wlist.draw, ((WlistWidget)self)->wheel.xft_col+0, ((WlistWidget)self)->wheel.xftFont, x,y, (FcChar8*)s,strlen(s) );
}
#line 612 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 612 "Wlist.widget"
static void init_graphics(Widget self)
#else
#line 612 "Wlist.widget"
static void init_graphics(self)Widget self;
#endif
#line 613 "Wlist.widget"
{
  if( ((WlistWidget)self)->wlist.line_width < ((WlistWidget)self)->core.width ) ((WlistWidget)self)->wlist.line_width = ((WlistWidget)self)->core.width;

  /* berechnen der puffer Größe: 4-Zeilen größer als das fenster */
  int height;
  height = ((int)(((WlistWidget)self)->core.height / ((WlistWidget)self)->wlist.line_height) + PREFETCH_BUFFER) * ((WlistWidget)self)->wlist.line_height;
  ((WlistWidget)self)->wlist.buf.height = height;
  ((WlistWidget)self)->wlist.buf.width  = ((WlistWidget)self)->wlist.line_width;
  ((WlistWidget)self)->wlist.buf.x = 0;
  ((WlistWidget)self)->wlist.buf.y = 0;
  ((WlistWidget)self)->wlist.first_line=0;

  if( ((WlistWidget)self)->wlist.pixmap ) XFreePixmap( ((WlistWidget)self)->wlist.dpy, ((WlistWidget)self)->wlist.pixmap );
  ((WlistWidget)self)->wlist.pixmap = XCreatePixmap(((WlistWidget)self)->wlist.dpy, XtWindow(self), ((WlistWidget)self)->wlist.buf.width, ((WlistWidget)self)->wlist.buf.height,
                         DefaultDepth(((WlistWidget)self)->wlist.dpy, DefaultScreen(((WlistWidget)self)->wlist.dpy)));

  if( ((WlistWidget)self)->wlist.draw) XftDrawDestroy( ((WlistWidget)self)->wlist.draw );
  ((WlistWidget)self)->wlist.draw = XftDrawCreate(((WlistWidget)self)->wlist.dpy, ((WlistWidget)self)->wlist.pixmap,
                       DefaultVisual(((WlistWidget)self)->wlist.dpy, DefaultScreen(((WlistWidget)self)->wlist.dpy)), None);

		       
}
#line 636 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 636 "Wlist.widget"
static void update_pixmap_complete(Widget self)
#else
#line 636 "Wlist.widget"
static void update_pixmap_complete(self)Widget self;
#endif
#line 637 "Wlist.widget"
{
	int i = 0;
	int line_no = ((WlistWidget)self)->wlist.buf.y / ((WlistWidget)self)->wlist.line_height;
	int max = ((WlistWidget)self)->wlist.buf.height / ((WlistWidget)self)->wlist.line_height;

	update_line_state(self); // check line_max

	if( line_no + max -1 >= ((WlistWidget)self)->wlist.line_max ) {
	    max = (((WlistWidget)self)->wlist.line_max - line_no);
	    int h = ((WlistWidget)self)->wlist.buf.height - max * ((WlistWidget)self)->wlist.line_height;
	    int w = ((WlistWidget)self)->wlist.buf.width;
	    XFillRectangle( ((WlistWidget)self)->wlist.dpy, ((WlistWidget)self)->wlist.pixmap, ((WlistWidget)self)->wheel.gc[0],
	    		    0, max * ((WlistWidget)self)->wlist.line_height, w, h );
	}

	while( i< max ) {
	       print_pixmap( self, line_no+i, i );
	       i++;
	}
}
#line 662 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 662 "Wlist.widget"
static void update_cache(Widget self)
#else
#line 662 "Wlist.widget"
static void update_cache(self)Widget self;
#endif
#line 663 "Wlist.widget"
{
  int ln_pos, ln_no, buf_a, buf_h, cur_buf_a, buf_d, list_h;
  update_line_state(self); // check line_max
  list_h = ((WlistWidget)self)->wlist.line_max * ((WlistWidget)self)->wlist.line_height;
  /* top_y, top_x korrigieren */
  /* falls der x-offset zu groß ist, verkleinern */
  if( ((WlistWidget)self)->wlist.top_x &&  (((WlistWidget)self)->wlist.top_x + ((WlistWidget)self)->core.width > ((WlistWidget)self)->wlist.line_width) ) {
    if( ((WlistWidget)self)->core.width < ((WlistWidget)self)->wlist.line_width ) ((WlistWidget)self)->wlist.top_x = ((WlistWidget)self)->wlist.line_width - ((WlistWidget)self)->core.width;
    else 	     		   ((WlistWidget)self)->wlist.top_x = 0;
  }
  /* falls die liste vollständig angezeigt werden kann, */
  /* oder der rest der liste das fenster nicht füllt */
  if( ((WlistWidget)self)->wlist.top_y + ((WlistWidget)self)->wlist.list_height > list_h ) {
    /* printf( "top_y:%d\n", $top_y ); */
    if( ((WlistWidget)self)->wlist.list_height >= list_h ) ((WlistWidget)self)->wlist.top_y = 0;
    else                    ((WlistWidget)self)->wlist.top_y = list_h - ((WlistWidget)self)->wlist.list_height;

    /* printf( "top_y:%d\n", $top_y ); */
  }

  /* anzuzeigender bereich liegt im puffer */
  if( ((WlistWidget)self)->wlist.top_y + ((WlistWidget)self)->core.height <= ((WlistWidget)self)->wlist.buf.y + ((WlistWidget)self)->wlist.buf.height &&
      ((WlistWidget)self)->wlist.top_y >= ((WlistWidget)self)->wlist.buf.y ) return;

  buf_h = ((WlistWidget)self)->wlist.buf.height / ((WlistWidget)self)->wlist.line_height;	/* anzahl zeilen im Puffer */
  cur_buf_a = ((WlistWidget)self)->wlist.buf.y / ((WlistWidget)self)->wlist.line_height;	/* erste zeile */
  buf_a = ((WlistWidget)self)->wlist.top_y / ((WlistWidget)self)->wlist.line_height;        /* neue erste zeile */
  buf_d = buf_a - cur_buf_a;		/* abstand in zeilen */
  ((WlistWidget)self)->wlist.first_line = cur_buf_a;  
  if( buf_d == 0 ) goto update_all;

  if( buf_d > 0 ) {	/* neue erste zeile > puffer erste zeile */
    if( buf_d >= buf_h ) goto update_all;
    scroll_up_lines(self, buf_d );
    ln_pos = buf_h - buf_d;
    ln_no = cur_buf_a + buf_h;  /* letzte zeile +1*/
  }
  else {                  /* neue erste zeile < puffer erste zeile */
    buf_d = -buf_d;
    if( buf_d >= buf_h ) goto update_all;

	    if( buf_d < PREFETCH_BUFFER ) {
	    	if( buf_a > PREFETCH_BUFFER - buf_d ) {
		    buf_a -= PREFETCH_BUFFER - buf_d;
		    buf_d = PREFETCH_BUFFER;
		} else {
		    buf_d += buf_a;
		    buf_a = 0;
		}
	    }

	    scroll_down_lines(self, buf_d );
	    ln_pos = 0; ln_no = buf_a;
            /*
	    printf( "cur_buf_a=%d, buf_h = %d, buf_a=%d\n", cur_buf_a, buf_h, buf_a );
	    printf( "buf_d = %d, ln_no=%d, ln_pos = %d\n", buf_d, ln_no, ln_pos );
            */

	}

	while( buf_d-- ) {
      	    print_pixmap(self, ln_no + buf_d, ln_pos + buf_d );
    	}

	((WlistWidget)self)->wlist.buf.y = buf_a * ((WlistWidget)self)->wlist.line_height; /* neue startposition setzen */
	((WlistWidget)self)->wlist.first_line = buf_a;
	return;
	/*-----------------------------------------------------------------*/

	update_all:
	((WlistWidget)self)->wlist.buf.y = buf_a * ((WlistWidget)self)->wlist.line_height;
	((WlistWidget)self)->wlist.first_line = buf_a;
	update_pixmap_complete(self);
	/*-----------------------------------------------------------------*/
}
#line 739 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 739 "Wlist.widget"
static int  translate_ypos_to_lineno(Widget self,int  y)
#else
#line 739 "Wlist.widget"
static int  translate_ypos_to_lineno(self,y)Widget self;int  y;
#endif
#line 740 "Wlist.widget"
{
  int line_no;
  y -= ((WlistWidget)self)->wlist.titleBarHeight;
  line_no = (((WlistWidget)self)->wlist.top_y + y) / ((WlistWidget)self)->wlist.line_height;
  return line_no;
}
#line 748 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 748 "Wlist.widget"
static void autoscroll_cb(XtPointer  client_data,XtIntervalId * id)
#else
#line 748 "Wlist.widget"
static void autoscroll_cb(client_data,id)XtPointer  client_data;XtIntervalId * id;
#endif
#line 749 "Wlist.widget"
{
	Widget self = (Widget) client_data;

	int new_y = ((WlistWidget)self)->wlist.top_y + ((WlistWidget)self)->wlist.pixel_to_scroll;

	if( new_y > 0 && new_y + ((WlistWidget)self)->core.height < ((WlistWidget)self)->wlist.line_max * ((WlistWidget)self)->wlist.line_height && ((WlistWidget)self)->wlist.autoscroll_cnt > 0 )
	{
		((WlistWidget)self)->wlist.autoscroll_id =
	  	   XtAppAddTimeOut( XtWidgetToApplicationContext( self ), 100, autoscroll_cb, self );
		((WlistWidget)self)->wlist.autoscroll_cnt--;
		gotoxy( self, -1, new_y );
	}
}
#line 763 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 763 "Wlist.widget"
static void  start_autoscroll(Widget self,int  y,ulong  t)
#else
#line 763 "Wlist.widget"
static void  start_autoscroll(self,y,t)Widget self;int  y;ulong  t;
#endif
#line 764 "Wlist.widget"
{
	((WlistWidget)self)->wlist.autoscroll_cnt  =  25;
	float speed = fabs( (((WlistWidget)self)->wlist.drag_start_y - y) * 1.0 / t );
	float pixel_total = (((WlistWidget)self)->wlist.drag_start_y - y) / speed;
	float pixel_per_update = 1+ pixel_total / ((WlistWidget)self)->wlist.autoscroll_cnt;
	printf( "drag_y0:%d, y1:%d\n", ((WlistWidget)self)->wlist.drag_start_y, y );
	printf( "autoscroll started: speed:%f, pixel_total:%f\n", speed, pixel_total );

	((WlistWidget)self)->wlist.pixel_to_scroll =  pixel_per_update;

	((WlistWidget)self)->wlist.autoscroll_id = XtAppAddTimeOut( XtWidgetToApplicationContext( self ), 40, autoscroll_cb, self );
}
#line 777 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 777 "Wlist.widget"
static void  set_line_state(Widget self,int  lineno,wheel_colors  col)
#else
#line 777 "Wlist.widget"
static void  set_line_state(self,lineno,col)Widget self;int  lineno;wheel_colors  col;
#endif
#line 778 "Wlist.widget"
{
	if( lineno < 0 || lineno >= m_len(((WlistWidget)self)->wlist.line_state) ) return;

	CHAR(((WlistWidget)self)->wlist.line_state, lineno) = col;
	/* check screen update */
	int first_line = ((WlistWidget)self)->wlist.buf.y / ((WlistWidget)self)->wlist.line_height;
	int last_line = first_line + ((WlistWidget)self)->wlist.buf.height / ((WlistWidget)self)->wlist.line_height;
	if( lineno >= first_line && lineno < last_line ) {
	    print_pixmap( self, lineno, lineno - first_line );
	    update_list(self);
	}
}
#line 791 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 791 "Wlist.widget"
static void  toggle_line_state(Widget self,int  lineno)
#else
#line 791 "Wlist.widget"
static void  toggle_line_state(self,lineno)Widget self;int  lineno;
#endif
#line 792 "Wlist.widget"
{
  if( lineno < 0 || lineno >= m_len(((WlistWidget)self)->wlist.line_state) ) return;
  wheel_colors col = CHAR( ((WlistWidget)self)->wlist.line_state, lineno );
  col = !col;
  set_line_state( self, lineno, col );
}
#line 802 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 802 "Wlist.widget"
static void update_tabs(Widget self)
#else
#line 802 "Wlist.widget"
static void update_tabs(self)Widget self;
#endif
#line 803 "Wlist.widget"
{
  if( ! ((WlistWidget)self)->wlist.tabs ) return;
  int mult = ((WlistWidget)self)->wlist.unit;
  if( mult == 0 ) mult = xft_textwidth( ((WlistWidget)self)->wlist.dpy, ((WlistWidget)self)->wheel.xftFont, "w" );
  if( ((WlistWidget)self)->wlist.tab_pos )
    m_clear(((WlistWidget)self)->wlist.tab_pos);
  else ((WlistWidget)self)->wlist.tab_pos = m_create(10,sizeof(int));

  int p,*d, v;
  m_foreach( ((WlistWidget)self)->wlist.tabs, p, d ) {
    v = (*d) * mult;
    m_put( ((WlistWidget)self)->wlist.tab_pos, &v );
  }
}
#line 818 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 818 "Wlist.widget"
static int  tabbed_str_width(Display * dpy,int  tabs,XftFont * font,char * buf)
#else
#line 818 "Wlist.widget"
static int  tabbed_str_width(dpy,tabs,font,buf)Display * dpy;int  tabs;XftFont * font;char * buf;
#endif
#line 819 "Wlist.widget"
{
  char **str;
  int p,
      cur_x = 0,
      cur_tab = 0;
  int subs=m_split(0,buf, '\t', 1 );
  int last_substr = m_len(subs) > 0 ? m_len(subs)-1 : 0;

  m_foreach( subs, p, str ) {
    cur_x +=  xft_textwidth( dpy, font, *str );

    if( p != last_substr && tabs ) {
        while( cur_tab < m_len(tabs) ) {
           if( INT(tabs,cur_tab) > cur_x )
           {
              cur_x = INT(tabs,cur_tab);
              break;
           }
           cur_tab++; /* skip this tab */
        }
    }
  }
  m_free_strings(subs,0);
  return cur_x;
}
#line 846 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 846 "Wlist.widget"
static int  render_substr(Widget self,XftDraw * draw,XftColor * col,XftFont * font,int  x,int  y,char * s)
#else
#line 846 "Wlist.widget"
static int  render_substr(self,draw,col,font,x,y,s)Widget self;XftDraw * draw;XftColor * col;XftFont * font;int  x;int  y;char * s;
#endif
#line 847 "Wlist.widget"
{
  int xoff;
  if(is_empty(s) ) return 0;

  xoff = xft_textwidth( ((WlistWidget)self)->wlist.dpy, font, s );
  XftDrawStringUtf8(draw, col, font,
                    x,y, (FcChar8*)s,strlen(s) );
  return xoff;
}
#line 859 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 859 "Wlist.widget"
static void render_mstr(Widget self,int  tabs,XftDraw * draw,XftColor * col,XftFont * font,int  pix_x,int  pix_y,char * buf)
#else
#line 859 "Wlist.widget"
static void render_mstr(self,tabs,draw,col,font,pix_x,pix_y,buf)Widget self;int  tabs;XftDraw * draw;XftColor * col;XftFont * font;int  pix_x;int  pix_y;char * buf;
#endif
#line 860 "Wlist.widget"
{
  if( is_empty(buf) ) return;

  int cur_tab = 0; /* index des nächsten tab */
  int xoff;        /* größe des teil-str. in pixel */
  int cur_x = 0;   /* x-pos. des nächsten str. in pixel */
  int subs=m_split(0,buf, '\t', 0 );
  int p;
  char **str;
  m_foreach( subs, p, str ) {
    if( cur_x >= ((WlistWidget)self)->wlist.buf.width ) break;
    xoff = render_substr(self, draw,col,font, pix_x + cur_x, pix_y, *str);
    cur_x += xoff;
    if( tabs ) {
        while( cur_tab < m_len(tabs) ) {
           if( INT(tabs,cur_tab) > cur_x )
           {
              cur_x = INT(tabs,cur_tab);
              break;
           }
           cur_tab++; /* skip this tab */
        }
    }
  }

  m_free_strings(subs,0);
}
#line 888 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 888 "Wlist.widget"
static void update_widget_state(Widget self)
#else
#line 888 "Wlist.widget"
static void update_widget_state(self)Widget self;
#endif
#line 889 "Wlist.widget"
{
  if( ((WlistWidget)self)->wheel.state >= STATE_MAX ) ((WlistWidget)self)->wheel.state=0;
  XSetWindowBorder( ((WlistWidget)self)->wlist.dpy, XtWindow(self),
                        ((WlistWidget)self)->wheel.pixel[((WlistWidget)self)->wheel.state + COLOR_FG_MAX] );
}
#line 895 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 895 "Wlist.widget"
static void update_titlebar(Widget self)
#else
#line 895 "Wlist.widget"
static void update_titlebar(self)Widget self;
#endif
#line 896 "Wlist.widget"
{

  uint y = ((WlistWidget)self)->wlist.titleBarHeight;
  XFillRectangle( ((WlistWidget)self)->wlist.dpy,XtWindow(self),((WlistWidget)self)->wlist.titleBarGC, 0,0,((WlistWidget)self)->core.width,y);
  XDrawLine( ((WlistWidget)self)->wlist.dpy,XtWindow(self),((WlistWidget)self)->wheel.gc[1],0,y-2,((WlistWidget)self)->core.width, y-2 );
  render_mstr( self, ((WlistWidget)self)->wlist.tab_pos, ((WlistWidget)self)->wlist.draw_title, ((WlistWidget)self)->wheel.xft_col, ((WlistWidget)self)->wheel.xftFont,
               0, ((WlistWidget)self)->wheel.xftFont->ascent, m_buf(((WlistWidget)self)->wlist.titleBar) );
}
#line 906 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 906 "Wlist.widget"
static int  is_cached(Widget self,int  lineno)
#else
#line 906 "Wlist.widget"
static int  is_cached(self,lineno)Widget self;int  lineno;
#endif
#line 907 "Wlist.widget"
{
  int first_line = ((WlistWidget)self)->wlist.buf.y / ((WlistWidget)self)->wlist.line_height;
  int last_line = first_line + ((WlistWidget)self)->wlist.buf.height / ((WlistWidget)self)->wlist.line_height;
  return( lineno >= first_line && lineno < last_line );
}
#line 913 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 913 "Wlist.widget"
static int  redraw_line(Widget self,int  lineno)
#else
#line 913 "Wlist.widget"
static int  redraw_line(self,lineno)Widget self;int  lineno;
#endif
#line 914 "Wlist.widget"
{
  int first_line = ((WlistWidget)self)->wlist.buf.y / ((WlistWidget)self)->wlist.line_height;
  int last_line = first_line + ((WlistWidget)self)->wlist.buf.height / ((WlistWidget)self)->wlist.line_height;
  if( lineno >= first_line && lineno < last_line ) {
    print_pixmap( self, lineno, lineno - first_line );
    return 1;
  }
  return 0;
}
#line 924 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 924 "Wlist.widget"
static void update_cursor(Widget self)
#else
#line 924 "Wlist.widget"
static void update_cursor(self)Widget self;
#endif
#line 925 "Wlist.widget"
{
  int dirty = 0;
  if( ((WlistWidget)self)->wlist.key_cursor == ((WlistWidget)self)->wlist.key_cursor_drawn ) return;

  if( ((WlistWidget)self)->wlist.key_cursor_drawn >= 0 ) {
    CHAR( ((WlistWidget)self)->wlist.line_state, ((WlistWidget)self)->wlist.key_cursor_drawn ) = ((WlistWidget)self)->wlist.key_cursor_state;
    dirty += redraw_line(self,((WlistWidget)self)->wlist.key_cursor_drawn);
    ((WlistWidget)self)->wlist.key_cursor_drawn=-1;
  }

  if( ((WlistWidget)self)->wlist.key_cursor >= 0 ) {

    if( ((WlistWidget)self)->wlist.key_cursor >= m_len(((WlistWidget)self)->wlist.line_state) )
      ((WlistWidget)self)->wlist.key_cursor = m_len(((WlistWidget)self)->wlist.line_state)-1;

    ((WlistWidget)self)->wlist.key_cursor_state = CHAR( ((WlistWidget)self)->wlist.line_state, ((WlistWidget)self)->wlist.key_cursor );
    CHAR(((WlistWidget)self)->wlist.line_state, ((WlistWidget)self)->wlist.key_cursor) = STATE_ARMED;
    ((WlistWidget)self)->wlist.key_cursor_drawn = ((WlistWidget)self)->wlist.key_cursor;
    redraw_line(self,((WlistWidget)self)->wlist.key_cursor);
    dirty = 1;
    int last_visible_line = (((WlistWidget)self)->wlist.top_y + ((WlistWidget)self)->wlist.list_height) / ((WlistWidget)self)->wlist.line_height;
    printf( "crsr:%d Vis:%d\n", ((WlistWidget)self)->wlist.key_cursor, last_visible_line );

    if( ((WlistWidget)self)->wlist.key_cursor >= last_visible_line ) {
      int y=(((WlistWidget)self)->wlist.key_cursor+1) * ((WlistWidget)self)->wlist.line_height - ((WlistWidget)self)->wlist.list_height;
      ((WlistWidgetClass)self->core.widget_class)->wlist_class.gotoxy(self,-1,y); dirty=0;
    }
    else if( ((WlistWidget)self)->wlist.key_cursor < (((WlistWidget)self)->wlist.top_y / ((WlistWidget)self)->wlist.line_height) )
      {
        ((WlistWidgetClass)self->core.widget_class)->wlist_class.gotoxy(self,-1,((WlistWidget)self)->wlist.key_cursor*((WlistWidget)self)->wlist.line_height); dirty=0;
      }
  }

  if( dirty ) update_list(self);
}
#line 961 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 961 "Wlist.widget"
static void clear_selection(Widget self)
#else
#line 961 "Wlist.widget"
static void clear_selection(self)Widget self;
#endif
#line 962 "Wlist.widget"
{
        int len = m_len(((WlistWidget)self)->wlist.line_state);
        while( len-- ) CHAR(((WlistWidget)self)->wlist.line_state,len)=0;
}
#line 968 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 968 "Wlist.widget"
static void update_list(Widget self)
#else
#line 968 "Wlist.widget"
static void update_list(self)Widget self;
#endif
#line 969 "Wlist.widget"
{
  uint bx = 1;
  uint by = ((WlistWidget)self)->wlist.titleBarHeight;
  update_cache(self);
  XCopyArea(((WlistWidget)self)->wlist.dpy,((WlistWidget)self)->wlist.pixmap,XtWindow(self), ((WlistWidget)self)->wlist.gc_copy,
            ((WlistWidget)self)->wlist.top_x, ((WlistWidget)self)->wlist.top_y - ((WlistWidget)self)->wlist.buf.y, ((WlistWidget)self)->core.width -2*bx, ((WlistWidget)self)->core.height-by,
	    bx, by );

  XtCallCallbackList( self, ((WlistWidget)self)->wlist.updatecb, NULL );
}

static XtResource resources[] = {
#line 53 "Wlist.widget"
{XtNtableStrs,XtCTableStrs,XtRInt,sizeof(((WlistRec*)NULL)->wlist.tableStrs),XtOffsetOf(WlistRec,wlist.tableStrs),XtRImmediate,(XtPointer)0 },
#line 54 "Wlist.widget"
{XtNfg,XtCFg,XtRXftColor,sizeof(((WlistRec*)NULL)->wlist.fg),XtOffsetOf(WlistRec,wlist.fg),XtRString,(XtPointer)"White"},
#line 55 "Wlist.widget"
{XtNnotify,XtCNotify,XtRCallback,sizeof(((WlistRec*)NULL)->wlist.notify),XtOffsetOf(WlistRec,wlist.notify),XtRImmediate,(XtPointer)NULL },
#line 56 "Wlist.widget"
{XtNgetEntry,XtCGetEntry,XtRCallback,sizeof(((WlistRec*)NULL)->wlist.getEntry),XtOffsetOf(WlistRec,wlist.getEntry),XtRImmediate,(XtPointer)NULL },
#line 57 "Wlist.widget"
{XtNupdatecb,XtCUpdatecb,XtRCallback,sizeof(((WlistRec*)NULL)->wlist.updatecb),XtOffsetOf(WlistRec,wlist.updatecb),XtRImmediate,(XtPointer)NULL },
#line 58 "Wlist.widget"
{XtNline_distance,XtCLine_distance,XtRInt,sizeof(((WlistRec*)NULL)->wlist.line_distance),XtOffsetOf(WlistRec,wlist.line_distance),XtRImmediate,(XtPointer)2 },
#line 59 "Wlist.widget"
{XtNtop_x,XtCTop_x,XtRInt,sizeof(((WlistRec*)NULL)->wlist.top_x),XtOffsetOf(WlistRec,wlist.top_x),XtRImmediate,(XtPointer)0 },
#line 60 "Wlist.widget"
{XtNtop_y,XtCTop_y,XtRInt,sizeof(((WlistRec*)NULL)->wlist.top_y),XtOffsetOf(WlistRec,wlist.top_y),XtRImmediate,(XtPointer)0 },
#line 62 "Wlist.widget"
{XtNprefered_width,XtCPrefered_width,XtRInt,sizeof(((WlistRec*)NULL)->wlist.prefered_width),XtOffsetOf(WlistRec,wlist.prefered_width),XtRImmediate,(XtPointer)0 },
#line 63 "Wlist.widget"
{XtNprefered_height,XtCPrefered_height,XtRInt,sizeof(((WlistRec*)NULL)->wlist.prefered_height),XtOffsetOf(WlistRec,wlist.prefered_height),XtRImmediate,(XtPointer)0 },
#line 64 "Wlist.widget"
{XtNvisible_lines,XtCVisible_lines,XtRInt,sizeof(((WlistRec*)NULL)->wlist.visible_lines),XtOffsetOf(WlistRec,wlist.visible_lines),XtRImmediate,(XtPointer)10 },
#line 67 "Wlist.widget"
{XtNmultiline,XtCMultiline,XtRInt,sizeof(((WlistRec*)NULL)->wlist.multiline),XtOffsetOf(WlistRec,wlist.multiline),XtRImmediate,(XtPointer)1 },
#line 70 "Wlist.widget"
{XtNfirst_line,XtCFirst_line,XtRInt,sizeof(((WlistRec*)NULL)->wlist.first_line),XtOffsetOf(WlistRec,wlist.first_line),XtRImmediate,(XtPointer)0 },
#line 74 "Wlist.widget"
{XtNline_max,XtCLine_max,XtRInt,sizeof(((WlistRec*)NULL)->wlist.line_max),XtOffsetOf(WlistRec,wlist.line_max),XtRImmediate,(XtPointer)0 },
#line 78 "Wlist.widget"
{XtNline_height,XtCLine_height,XtRInt,sizeof(((WlistRec*)NULL)->wlist.line_height),XtOffsetOf(WlistRec,wlist.line_height),XtRImmediate,(XtPointer)0 },
#line 82 "Wlist.widget"
{XtNlist_height,XtCList_height,XtRInt,sizeof(((WlistRec*)NULL)->wlist.list_height),XtOffsetOf(WlistRec,wlist.list_height),XtRImmediate,(XtPointer)0 },
#line 84 "Wlist.widget"
{XtNline_width,XtCLine_width,XtRInt,sizeof(((WlistRec*)NULL)->wlist.line_width),XtOffsetOf(WlistRec,wlist.line_width),XtRImmediate,(XtPointer)0 },
#line 86 "Wlist.widget"
{XtNtabs,XtCTabs,XtRArrayInt,sizeof(((WlistRec*)NULL)->wlist.tabs),XtOffsetOf(WlistRec,wlist.tabs),XtRImmediate,(XtPointer)0 },
#line 89 "Wlist.widget"
{XtNunit,XtCUnit,XtRDistance,sizeof(((WlistRec*)NULL)->wlist.unit),XtOffsetOf(WlistRec,wlist.unit),XtRImmediate,(XtPointer)0 },
#line 91 "Wlist.widget"
{XtNline_bh,XtCLine_bh,XtRInt,sizeof(((WlistRec*)NULL)->wlist.line_bh),XtOffsetOf(WlistRec,wlist.line_bh),XtRImmediate,(XtPointer)0 },
#line 92 "Wlist.widget"
{XtNtitleBar,XtCTitleBar,XtRArrayChar,sizeof(((WlistRec*)NULL)->wlist.titleBar),XtOffsetOf(WlistRec,wlist.titleBar),XtRImmediate,(XtPointer)0 },
#line 93 "Wlist.widget"
{XtNtitleBarCol,XtCTitleBarCol,XtRPixel,sizeof(((WlistRec*)NULL)->wlist.titleBarCol),XtOffsetOf(WlistRec,wlist.titleBarCol),XtRString,(XtPointer)"#101010"},
};

WlistClassRec wlistClassRec = {
{ /* core_class part */
/* superclass   	*/  (WidgetClass) &wheelClassRec,
/* class_name   	*/  "Wlist",
/* widget_size  	*/  sizeof(WlistRec),
/* class_initialize 	*/  class_initialize,
/* class_part_initialize*/  _resolve_inheritance,
/* class_inited 	*/  FALSE,
/* initialize   	*/  initialize,
/* initialize_hook 	*/  NULL,
/* realize      	*/  realize,
/* actions      	*/  actionsList,
/* num_actions  	*/  6,
/* resources    	*/  resources,
/* num_resources 	*/  22,
/* xrm_class    	*/  NULLQUARK,
/* compres_motion 	*/  False ,
/* compress_exposure 	*/  FALSE ,
/* compress_enterleave 	*/  False ,
/* visible_interest 	*/  False ,
/* destroy      	*/  destroy,
/* resize       	*/  resize,
/* expose       	*/  expose,
/* set_values   	*/  set_values,
/* set_values_hook 	*/  NULL,
/* set_values_almost 	*/  XtInheritSetValuesAlmost,
/* get_values+hook 	*/  NULL,
/* accept_focus 	*/  XtInheritAcceptFocus,
/* version      	*/  XtVersion,
/* callback_private 	*/  NULL,
/* tm_table      	*/  defaultTranslations,
/* query_geometry 	*/  query_geometry,
/* display_acceleator 	*/  XtInheritDisplayAccelerator,
/* extension    	*/  NULL 
},
{ /* Wheel_class part */
exec_command,
XtInherit_sig_recv,
},
{ /* Wlist_class part */
gotoxy,
make_visible,
update_line,
draw_line,
},
};
WidgetClass wlistWidgetClass = (WidgetClass) &wlistClassRec;
/*ARGSUSED*/
#line 131 "Wlist.widget"
static void highlight(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
  if( ((WlistWidget)self)->wheel.state == STATE_NORMAL ) {
    ((WlistWidget)self)->wheel.state = STATE_SELECTED;
    update_widget_state(self);
  }
}

/*ARGSUSED*/
#line 139 "Wlist.widget"
static void reset(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
  if( ((WlistWidget)self)->wheel.state != STATE_NORMAL ) {
    ((WlistWidget)self)->wheel.state = STATE_NORMAL;
    update_widget_state(self);
  }
}

/*ARGSUSED*/
#line 148 "Wlist.widget"
static void motion_start(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
	int y = event->xbutton.y;
	int lineno;
	ulong t = (ulong ) event->xbutton.time;
	lineno = translate_ypos_to_lineno(self,y );
	if( ((WlistWidget)self)->wlist.drag_time == 0 ) goto restart_drag;

	/* drag startete vor über einer sekunde, seitdem keine änderung */
	/* darum: vergessen und neu starten */
	if( ((WlistWidget)self)->wlist.drag_update + 1000 < t ) goto restart_drag;
	((WlistWidget)self)->wlist.drag_update = t;

	if( y != ((WlistWidget)self)->wlist.drag_last_y ) {
	    int top = ((WlistWidget)self)->wlist.top_y + (((WlistWidget)self)->wlist.drag_last_y - y);
	    ((WlistWidget)self)->wlist.drag_last_y = y;
	    gotoxy( self, -1, top );
	}
	return; /* drag in progress */

  restart_drag:
	((WlistWidget)self)->wlist.drag_start_y = event->xbutton.y;
	((WlistWidget)self)->wlist.drag_last_y = event->xbutton.y;
	((WlistWidget)self)->wlist.drag_time = t;
	((WlistWidget)self)->wlist.drag_update = t;
	((WlistWidget)self)->wlist.drag_line_start = lineno;
	/* printf( "start %d\n",  lineno ); */
}

/*ARGSUSED*/
#line 177 "Wlist.widget"
static void motion_end(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
      int y = event->xbutton.y;
      ulong t = (ulong ) event->xbutton.time;
      int lineno = translate_ypos_to_lineno(self,event->xbutton.y );

      if( ((WlistWidget)self)->wlist.drag_time == 0 || t < ((WlistWidget)self)->wlist.drag_time ) goto click;

      t -= ((WlistWidget)self)->wlist.drag_time;
      /* printf( "line: start: %d, end: %d, time: %ld\n", $drag_line_start, lineno, t ); */

      y -= ((WlistWidget)self)->wlist.drag_start_y;
      if( y > -15 && y < 15 ) goto click;

      /*      if( t < AUTO_SCROLL_TIME_MS ) { start_autoscroll($, event->xbutton.y, t ); }
      */

      goto reset_drag;

      /* kein drag nur ein click */
      click:
      XtCallCallbackList(self, ((WlistWidget)self)->wlist.notify, (XtPointer) (intptr_t)lineno );
      // toggle_line_state( self, lineno );
      goto reset_drag;

      reset_drag:
      ((WlistWidget)self)->wlist.drag_time = 0;
}

/*ARGSUSED*/
#line 206 "Wlist.widget"
static void toggle_line_state_act(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
	int lineno = translate_ypos_to_lineno(self,event->xbutton.y );
	toggle_line_state( self, lineno );
}

/*ARGSUSED*/
#line 218 "Wlist.widget"
static void select_line(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
	int lineno = translate_ypos_to_lineno(self,event->xbutton.y );
	XtCallCallbackList(self,((WlistWidget)self)->wlist.notify,(XtPointer)(intptr_t)lineno);
}

static void _resolve_inheritance(class)
WidgetClass class;
{
  WlistWidgetClass c __attribute__((unused)) = (WlistWidgetClass) class;
  WlistWidgetClass super __attribute__((unused));
  if (class == wlistWidgetClass) return;
  super = (WlistWidgetClass)class->core_class.superclass;
  if (c->wlist_class.gotoxy == XtInherit_gotoxy)
    c->wlist_class.gotoxy = super->wlist_class.gotoxy;
  if (c->wlist_class.make_visible == XtInherit_make_visible)
    c->wlist_class.make_visible = super->wlist_class.make_visible;
  if (c->wlist_class.update_line == XtInherit_update_line)
    c->wlist_class.update_line = super->wlist_class.update_line;
  if (c->wlist_class.draw_line == XtInherit_draw_line)
    c->wlist_class.draw_line = super->wlist_class.draw_line;
}
#line 226 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 226 "Wlist.widget"
static XtGeometryResult  query_geometry(Widget self,XtWidgetGeometry * request,XtWidgetGeometry * reply)
#else
#line 226 "Wlist.widget"
static XtGeometryResult  query_geometry(self,request,reply)Widget self;XtWidgetGeometry * request;XtWidgetGeometry * reply;
#endif
#line 227 "Wlist.widget"
{
	calc_geometry(self);
    reply->request_mode = CWX | CWY | CWWidth | CWHeight;
    reply->x=0; reply->y=0;
    reply->width =  ((WlistWidget)self)->wlist.prefered_width;
    reply->height = ((WlistWidget)self)->wlist.prefered_height;

    TRACE(1, "Wlist:%s: parent request is: %dx%d", XtName(self),
             request->width,
             request->width );

    TRACE(1, "Wlist:%s: our prefered size is %dx%d", XtName(self),
                  ((WlistWidget)self)->wlist.prefered_width,
                  ((WlistWidget)self)->wlist.prefered_height );

    return XtGeometryAlmost;
}
#line 248 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 248 "Wlist.widget"
static int  exec_command(Widget self,int  cmd,int  val)
#else
#line 248 "Wlist.widget"
static int  exec_command(self,cmd,val)Widget self;int  cmd;int  val;
#endif
#line 249 "Wlist.widget"
{
  switch( cmd ) {
  case WHEEL_FIRE:
    if( ((WlistWidget)self)->wheel.state == STATE_ARMED ) {
      ((WlistWidget)self)->wheel.state = STATE_SELECTED;
      ((WlistWidget)self)->wlist.key_cursor = -1;
    }
    else {
      ((WlistWidget)self)->wheel.state = STATE_ARMED;
      ((WlistWidget)self)->wlist.key_cursor = ((WlistWidget)self)->wlist.top_y / ((WlistWidget)self)->wlist.line_height;
    }
    update_widget_state(self);
    update_cursor(self);
    return 1;

  case WHEEL_LEFT:
    if( ((WlistWidget)self)->wheel.state != STATE_ARMED ) return 0;
    if( ((WlistWidget)self)->wlist.key_cursor > 0 )
      ((WlistWidget)self)->wlist.key_cursor--;
    update_cursor(self);
    return 1;

  case WHEEL_RIGHT:
    if( ((WlistWidget)self)->wheel.state != STATE_ARMED ) return 0;
    ((WlistWidget)self)->wlist.key_cursor++;
    update_cursor(self);
    return 1;
  }

  return 0; /* not used */
}
#line 284 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 284 "Wlist.widget"
static void gotoxy(Widget self,int  x,int  y)
#else
#line 284 "Wlist.widget"
static void gotoxy(self,x,y)Widget self;int  x;int  y;
#endif
#line 285 "Wlist.widget"
{
	if( x >= 0 ) ((WlistWidget)self)->wlist.top_x = x;
	if( y >= 0 ) ((WlistWidget)self)->wlist.top_y = y;
	TRACE(9, "%d %d", ((WlistWidget)self)->wlist.top_x, ((WlistWidget)self)->wlist.top_y );
	update_list(self);
}
#line 295 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 295 "Wlist.widget"
static void make_visible(Widget self,int  line_number)
#else
#line 295 "Wlist.widget"
static void make_visible(self,line_number)Widget self;int  line_number;
#endif
#line 296 "Wlist.widget"
{
  /* falls line_number im Cache -- redraw */

  /* setze buf.y so dass line_number am ende des cache liegt */
  /* setze top_y so dass letzte cache zeile angezeigt werden kann */
}
#line 311 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 311 "Wlist.widget"
static void update_line(Widget self,int  line_number)
#else
#line 311 "Wlist.widget"
static void update_line(self,line_number)Widget self;int  line_number;
#endif
#line 312 "Wlist.widget"
{
  int y;

  if( ! ((WlistWidget)self)->wlist.draw ) return;
  update_line_state(self);
  y = line_number * ((WlistWidget)self)->wlist.line_height;
  /* inside cache ? */
  if( y >= ((WlistWidget)self)->wlist.buf.y && y < ((WlistWidget)self)->wlist.buf.height + ((WlistWidget)self)->wlist.buf.y ) {
    ((WlistWidgetClass)self->core.widget_class)->wlist_class.draw_line(self, line_number);
    /* visible ? */
    if( y >= ((WlistWidget)self)->wlist.top_y && y < ((WlistWidget)self)->wlist.top_y + ((WlistWidget)self)->core.height ) {
      ((WlistWidgetClass)self->core.widget_class)->core_class.expose( self, NULL, NULL );
      return;
    }
    /* not visible, but inside cache, move top_y */
  }

  /* outside cache! move top_y */
  ((WlistWidget)self)->wlist.top_y = y - ((WlistWidget)self)->core.height + ((WlistWidget)self)->wlist.line_height;
  ((WlistWidgetClass)self->core.widget_class)->core_class.expose( self, NULL, NULL );
}
#line 334 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 334 "Wlist.widget"
static void draw_line(Widget self,int  line_number)
#else
#line 334 "Wlist.widget"
static void draw_line(self,line_number)Widget self;int  line_number;
#endif
#line 335 "Wlist.widget"
{
  int y = line_number * ((WlistWidget)self)->wlist.line_height;
  /* outside  cache ? */
  if( y < ((WlistWidget)self)->wlist.buf.y || y >= ((WlistWidget)self)->wlist.buf.height + ((WlistWidget)self)->wlist.buf.y ) return;
  y = line_number - (((WlistWidget)self)->wlist.buf.y / ((WlistWidget)self)->wlist.line_height); /* pos. im cache */
  print_pixmap( self, line_number, y );
}
#line 343 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 343 "Wlist.widget"
static void initialize(Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 343 "Wlist.widget"
static void initialize(request,self,args,num_args)Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 344 "Wlist.widget"
{
        /* TODO: dpy initialisierung in andere wlist widgets uebertragen */
        ((WlistWidget)self)->wlist.dpy = XtDisplay(self);

  if( ((WlistWidget)self)->wlist.multiline == 0 ) ((WlistWidget)self)->wlist.multiline = 1;
  ((WlistWidget)self)->wlist.gc_copy =  XtGetGC(self, 0,0 );
  ((WlistWidget)self)->wlist.draw = NULL;
  /* trennlinie ist 2 pixel hoch */
  ((WlistWidget)self)->wlist.line_height = ((WlistWidget)self)->wheel.xftFont->height * ((WlistWidget)self)->wlist.multiline + ((WlistWidget)self)->wlist.line_distance + 2;
  ((WlistWidget)self)->wlist.line_state = m_create(100,1);
  

  update_tabs(self);
  if( ((WlistWidget)self)->wlist.titleBar ) {
      ((WlistWidget)self)->wlist.titleBarHeight = ((WlistWidget)self)->wheel.xftFont->height+3;
      ((WlistWidget)self)->wlist.titleBarWidth = tabbed_str_width(((WlistWidget)self)->wlist.dpy, ((WlistWidget)self)->wlist.tab_pos, ((WlistWidget)self)->wheel.xftFont, m_buf(((WlistWidget)self)->wlist.titleBar));
   }
   else {
     ((WlistWidget)self)->wlist.titleBarHeight = 1;
     ((WlistWidget)self)->wlist.titleBarWidth  = 20;
   }

  if( ((WlistWidget)self)->core.width == 0 ) ((WlistWidget)self)->core.width = ((WlistWidget)self)->wlist.titleBarWidth;
  ((WlistWidget)self)->wlist.line_width = ((WlistWidget)self)->core.width;

  ((WlistWidget)self)->wlist.key_cursor_drawn = -1;
  ((WlistWidget)self)->wlist.key_cursor = -1;

  XtGCMask mask;
  XGCValues values;
  mask = GCForeground;
  values.foreground = ((WlistWidget)self)->wlist.titleBarCol;
  ((WlistWidget)self)->wlist.titleBarGC = XtGetGC(self,mask,&values);

  if( ((WlistWidget)self)->core.height == 0 ) ((WlistWidget)self)->core.height = 20;
}
#line 381 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 381 "Wlist.widget"
static void destroy(Widget self)
#else
#line 381 "Wlist.widget"
static void destroy(self)Widget self;
#endif
#line 382 "Wlist.widget"
{
  XtReleaseGC(self,((WlistWidget)self)->wlist.titleBarGC);
  XtReleaseGC(self,((WlistWidget)self)->wlist.gc_copy);
  if( ((WlistWidget)self)->wlist.draw) XftDrawDestroy( ((WlistWidget)self)->wlist.draw );
  if( ((WlistWidget)self)->wlist.pixmap ) XFreePixmap( ((WlistWidget)self)->wlist.dpy, ((WlistWidget)self)->wlist.pixmap );
  if( ((WlistWidget)self)->wlist.titleBar ) { m_free( ((WlistWidget)self)->wlist.titleBar ); ((WlistWidget)self)->wlist.titleBar=0; }
  m_free( ((WlistWidget)self)->wlist.tab_pos );
  m_free( ((WlistWidget)self)->wlist.tabs);
  m_free( ((WlistWidget)self)->wlist.line_state );
}
#line 393 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 393 "Wlist.widget"
static void realize(Widget self,XtValueMask * mask,XSetWindowAttributes * attributes)
#else
#line 393 "Wlist.widget"
static void realize(self,mask,attributes)Widget self;XtValueMask * mask;XSetWindowAttributes * attributes;
#endif
#line 394 "Wlist.widget"
{
     XtCreateWindow(self, (unsigned int) InputOutput,
                    (Visual *) CopyFromParent, *mask, attributes);
     ((WlistWidget)self)->wlist.draw_title = XftDrawCreate( ((WlistWidget)self)->wlist.dpy, XtWindow(self),
                                  DefaultVisual(((WlistWidget)self)->wlist.dpy, DefaultScreen(((WlistWidget)self)->wlist.dpy)), None);

     init_graphics(self);
     update_pixmap_complete(self);
 }
#line 404 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 404 "Wlist.widget"
static void expose(Widget self,XEvent * event,Region  region)
#else
#line 404 "Wlist.widget"
static void expose(self,event,region)Widget self;XEvent * event;Region  region;
#endif
#line 405 "Wlist.widget"
{
	if( !XtIsRealized(self)) return;
        if( ((WlistWidget)self)->wlist.titleBar ) update_titlebar(self);
        ((WlistWidget)self)->wlist.list_height = ((WlistWidget)self)->core.height - ((WlistWidget)self)->wlist.titleBarHeight;
        update_list(self);
}
#line 414 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 414 "Wlist.widget"
static void class_initialize(void)
#else
#line 414 "Wlist.widget"
static void class_initialize()
#endif
#line 415 "Wlist.widget"
{
	  converters_init();
}
#line 421 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 421 "Wlist.widget"
static void resize(Widget self)
#else
#line 421 "Wlist.widget"
static void resize(self)Widget self;
#endif
#line 422 "Wlist.widget"
{
	/* der buffer sollte immer 3 zeilen größer als das window sein */
	if( XtIsRealized(self) )
	  if( ((WlistWidget)self)->core.height + 3 * ((WlistWidget)self)->wlist.line_height > ((WlistWidget)self)->wlist.buf.height || ((WlistWidget)self)->core.width > ((WlistWidget)self)->wlist.buf.width )
	  {
	 	init_graphics(self);
		update_pixmap_complete(self);
	  }
}
#line 432 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 432 "Wlist.widget"
static Boolean  set_values(Widget  old,Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 432 "Wlist.widget"
static Boolean  set_values(old,request,self,args,num_args)Widget  old;Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 433 "Wlist.widget"
{
	int n = *num_args;


	TRACE(2, "Wlist Widget %s", XtName(self) );

	/* wenn farben, font, zeilen-daten geändert worden sind,
           muss der cache aktualisiert werden
         */

         if( XtIsRealized(self) )
	 while( n-- )
	 {
                 if(strncmp( args[n].name, "tableS",6 ) == 0 )
                 {
                   clear_selection(self);
                   update_pixmap_complete(self);
                   break;
                 }


                 if( ( strncmp( args[n].name, "bg_",3 ) == 0 )
		     || ( strncmp( args[n].name, "fg", 2 ) == 0 )
		     || ( strncmp( args[n].name, "xftFont", 7 ) == 0 ) )
                  {
			update_pixmap_complete(self);
			break;
		  }
	 }


	return True; /* im zweifelsfall ist ein expose() immer richtig */
}
#line 11 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 11 "Wlist.widget"
void  wlist_gotoxy(Widget  w,int  x,int  y)
#else
#line 11 "Wlist.widget"
void  wlist_gotoxy(w,x,y)Widget  w;int  x;int  y;
#endif
#line 12 "Wlist.widget"
{
  WlistWidgetClass wc = (WlistWidgetClass)XtClass(w);
  if( XtIsSubclass( w, wlistWidgetClass) && wc->wlist_class.gotoxy )
    {
      wc->wlist_class.gotoxy(w,x,y);
    }
}
#line 20 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 20 "Wlist.widget"
void  wlist_update_line(Widget  w,int  line)
#else
#line 20 "Wlist.widget"
void  wlist_update_line(w,line)Widget  w;int  line;
#endif
#line 21 "Wlist.widget"
{
  WlistWidgetClass wc = (WlistWidgetClass)XtClass(w);
  if( XtIsSubclass( w, wlistWidgetClass) && wc->wlist_class.update_line )
    {
      wc->wlist_class.update_line(w,line);
    }
}
#line 29 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 29 "Wlist.widget"
void  wlist_set_line_state(Widget  w,int  lineno,wheel_colors  col)
#else
#line 29 "Wlist.widget"
void  wlist_set_line_state(w,lineno,col)Widget  w;int  lineno;wheel_colors  col;
#endif
#line 30 "Wlist.widget"
{
  WlistWidgetClass wc = (WlistWidgetClass)XtClass(w);
  if( XtIsSubclass(w, wlistWidgetClass) )
      set_line_state(  w, lineno, col );
}
#line 36 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 36 "Wlist.widget"
void  wlist_clear_selection(Widget  w)
#else
#line 36 "Wlist.widget"
void  wlist_clear_selection(w)Widget  w;
#endif
#line 37 "Wlist.widget"
{
  WlistWidgetClass wc = (WlistWidgetClass)XtClass(w);
  if( XtIsSubclass(w, wlistWidgetClass) )
      clear_selection(  w );
}
#line 44 "Wlist.widget"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 44 "Wlist.widget"
void  wlist_update_all(Widget self)
#else
#line 44 "Wlist.widget"
void  wlist_update_all(self)Widget self;
#endif
#line 45 "Wlist.widget"
{
	init_graphics(self);
	update_pixmap_complete(self);
	((WlistWidgetClass)self->core.widget_class)->core_class.expose(self,0,0);
}
